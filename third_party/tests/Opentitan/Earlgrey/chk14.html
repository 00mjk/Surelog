
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>hw/vendor/lowrisc_ibex/rtl/ibex_core.sv Coverage: 92%</h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Copyright 2018 ETH Zurich and University of Bologna, see also CREDITS.md.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`ifdef RISCV_FORMAL</pre>
<pre style="margin:0; padding:0 ">  `define RVFI</pre>
<pre style="margin:0; padding:0 ">`endif</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">/**</pre>
<pre style="margin:0; padding:0 "> * Top level module of the ibex RISC-V core</pre>
<pre style="margin:0; padding:0 "> */</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">module ibex_core #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter bit          PMPEnable                = 1'b0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter int unsigned PMPGranularity           = 0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter int unsigned PMPNumRegions            = 4,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter int unsigned MHPMCounterNum           = 0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter int unsigned MHPMCounterWidth         = 40,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter bit          RV32E                    = 1'b0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter bit          RV32M                    = 1'b1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter              MultiplierImplementation = "fast",</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter bit          DbgTriggerEn             = 1'b0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter int unsigned DmHaltAddr               = 32'h1A110800,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    parameter int unsigned DmExceptionAddr          = 32'h1A110808</pre>
<pre style="margin:0; padding:0 ">) (</pre>
<pre style="margin:0; padding:0 ">    // Clock and Reset</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        rst_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        test_en_i,     // enable all clock gates for testing</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic [31:0] hart_id_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic [31:0] boot_addr_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Instruction memory interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic        instr_req_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        instr_gnt_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        instr_rvalid_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic [31:0] instr_addr_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic [31:0] instr_rdata_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        instr_err_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Data memory interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic        data_req_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        data_gnt_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        data_rvalid_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic        data_we_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic [3:0]  data_be_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic [31:0] data_addr_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic [31:0] data_wdata_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic [31:0] data_rdata_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        data_err_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Interrupt inputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        irq_software_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        irq_timer_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        irq_external_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic [14:0] irq_fast_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        irq_nm_i,       // non-maskeable interrupt</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Debug Interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        debug_req_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // RISC-V Formal Interface</pre>
<pre style="margin:0; padding:0 ">    // Does not comply with the coding standards of _i/_o suffixes, but follows</pre>
<pre style="margin:0; padding:0 ">    // the convention of RISC-V Formal Interface Specification.</pre>
<pre style="margin:0; padding:0 ">`ifdef RVFI</pre>
<pre style="margin:0; padding:0 ">    output logic        rvfi_valid,</pre>
<pre style="margin:0; padding:0 ">    output logic [63:0] rvfi_order,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_insn,</pre>
<pre style="margin:0; padding:0 ">    output logic        rvfi_trap,</pre>
<pre style="margin:0; padding:0 ">    output logic        rvfi_halt,</pre>
<pre style="margin:0; padding:0 ">    output logic        rvfi_intr,</pre>
<pre style="margin:0; padding:0 ">    output logic [ 1:0] rvfi_mode,</pre>
<pre style="margin:0; padding:0 ">    output logic [ 4:0] rvfi_rs1_addr,</pre>
<pre style="margin:0; padding:0 ">    output logic [ 4:0] rvfi_rs2_addr,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_rs1_rdata,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_rs2_rdata,</pre>
<pre style="margin:0; padding:0 ">    output logic [ 4:0] rvfi_rd_addr,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_rd_wdata,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_pc_rdata,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_pc_wdata,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_mem_addr,</pre>
<pre style="margin:0; padding:0 ">    output logic [ 3:0] rvfi_mem_rmask,</pre>
<pre style="margin:0; padding:0 ">    output logic [ 3:0] rvfi_mem_wmask,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_mem_rdata,</pre>
<pre style="margin:0; padding:0 ">    output logic [31:0] rvfi_mem_wdata,</pre>
<pre style="margin:0; padding:0 ">`endif</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // CPU Control Signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    input  logic        fetch_enable_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    output logic        core_sleep_o</pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  import ibex_pkg::*;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int unsigned PMP_NUM_CHAN = 2;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // IF/ID signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_valid_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_new_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] instr_rdata_id;         // Instruction sampled inside IF stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [15:0] instr_rdata_c_id;       // Compressed instruction sampled inside IF stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_is_compressed_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_fetch_err;        // Bus error on instr fetch</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        illegal_c_insn_id;      // Illegal compressed instruction sent to ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] pc_if;                  // Program counter in IF stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] pc_id;                  // Program counter in ID stage</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_valid_clear;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        pc_set;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pc_sel_e     pc_mux_id;              // Mux selector for next PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  exc_pc_sel_e exc_pc_mux_id;          // Mux selector for exception PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  exc_cause_e  exc_cause;              // Exception cause</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        lsu_load_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        lsu_store_err;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // LSU signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        lsu_addr_incr_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] lsu_addr_last;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Jump and branch target and decision (EX->IF)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] jump_target_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        branch_decision;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Core busy signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        ctrl_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        if_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        lsu_busy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        core_busy_d, core_busy_q;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // ALU Control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  alu_op_e     alu_operator_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] alu_operand_a_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] alu_operand_b_ex;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] alu_adder_result_ex;    // Used to forward computed address to LSU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] regfile_wdata_ex;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Multiplier Control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        mult_en_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        div_en_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  md_op_e      multdiv_operator_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [1:0]  multdiv_signed_mode_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] multdiv_operand_a_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] multdiv_operand_b_ex;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CSR control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_access;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        valid_csr_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  csr_op_e     csr_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  csr_num_e    csr_addr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] csr_rdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] csr_wdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        illegal_csr_insn_id;    // CSR access to non-existent register,</pre>
<pre style="margin:0; padding:0 ">                                       // with wrong priviledge level,</pre>
<pre style="margin:0; padding:0 ">                                       // or missing write permissions</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Data Memory Control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        data_we_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [1:0]  data_type_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        data_sign_ext_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        data_req_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] data_wdata_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] regfile_wdata_lsu;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // stall control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        id_in_ready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        ex_valid;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        lsu_data_valid;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Signals between instruction core interface and pipe (if and id stages)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_req_int;          // Id stage asserts a req to instruction core interface</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Interrupts</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        irq_pending;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        nmi_mode;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_msip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_mtip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_meip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [14:0] csr_mfip;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_mstatus_mie;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] csr_mepc, csr_depc;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // PMP signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [33:0] csr_pmp_addr [PMPNumRegions];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pmp_cfg_t    csr_pmp_cfg  [PMPNumRegions];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        pmp_req_err  [PMP_NUM_CHAN];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_req_out;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        data_req_out;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_save_if;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_save_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_restore_mret_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_restore_dret_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_save_cause;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_mtvec_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] csr_mtvec;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [31:0] csr_mtval;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        csr_mstatus_tw;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  priv_lvl_e   priv_mode_id;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  priv_lvl_e   priv_mode_if;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  priv_lvl_e   priv_mode_lsu;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // debug mode and dcsr configuration</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        debug_mode;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  dbg_cause_e  debug_cause;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        debug_csr_save;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        debug_single_step;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        debug_ebreakm;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        debug_ebreaku;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        trigger_match;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // performance counter related signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_ret;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        instr_ret_compressed;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        perf_imiss;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        perf_jump;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        perf_branch;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        perf_tbranch;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        perf_load;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        perf_store;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // for RVFI</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        illegal_insn_id, unused_illegal_insn_id; // ID stage sees an illegal instruction</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // RISC-V Formal Interface signals</pre>
<pre style="margin:0; padding:0 ">`ifdef RVFI</pre>
<pre style="margin:0; padding:0 ">  logic        rvfi_intr_d;</pre>
<pre style="margin:0; padding:0 ">  logic        rvfi_set_trap_pc_d;</pre>
<pre style="margin:0; padding:0 ">  logic        rvfi_set_trap_pc_q;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_insn_id;</pre>
<pre style="margin:0; padding:0 ">  logic [4:0]  rvfi_rs1_addr_id;</pre>
<pre style="margin:0; padding:0 ">  logic [4:0]  rvfi_rs2_addr_id;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rs1_data_d;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rs1_data_id;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rs1_data_q;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rs2_data_d;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rs2_data_id;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rs2_data_q;</pre>
<pre style="margin:0; padding:0 ">  logic [4:0]  rvfi_rd_addr_id;</pre>
<pre style="margin:0; padding:0 ">  logic [4:0]  rvfi_rd_addr_q;</pre>
<pre style="margin:0; padding:0 ">  logic [4:0]  rvfi_rd_addr_d;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rd_wdata_id;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rd_wdata_d;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_rd_wdata_q;</pre>
<pre style="margin:0; padding:0 ">  logic        rvfi_rd_we_id;</pre>
<pre style="margin:0; padding:0 ">  logic        rvfi_insn_new_d;</pre>
<pre style="margin:0; padding:0 ">  logic        rvfi_insn_new_q;</pre>
<pre style="margin:0; padding:0 ">  logic [3:0]  rvfi_mem_mask_int;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_mem_rdata_d;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_mem_rdata_q;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_mem_wdata_d;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_mem_wdata_q;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_mem_addr_d;</pre>
<pre style="margin:0; padding:0 ">  logic [31:0] rvfi_mem_addr_q;</pre>
<pre style="margin:0; padding:0 ">`endif</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  //////////////////////</pre>
<pre style="margin:0; padding:0 ">  // Clock management //</pre>
<pre style="margin:0; padding:0 ">  //////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        clk;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        clock_en;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Before going to sleep, wait for I- and D-side</pre>
<pre style="margin:0; padding:0 ">  // interfaces to finish ongoing operations.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign core_busy_d = ctrl_busy | if_busy | lsu_busy;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      core_busy_q <= 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      core_busy_q <= core_busy_d;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign clock_en     = core_busy_q | debug_req_i | irq_pending | irq_nm_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign core_sleep_o = ~clock_en;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // main clock gate of the core</pre>
<pre style="margin:0; padding:0 ">  // generates all clocks except the one for the debug unit which is</pre>
<pre style="margin:0; padding:0 ">  // independent</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_clock_gating core_clock_gate_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .clk_i     ( clk_i           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .en_i      ( clock_en        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .test_en_i ( test_en_i       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .clk_o     ( clk             )</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  //////////////</pre>
<pre style="margin:0; padding:0 ">  // IF stage //</pre>
<pre style="margin:0; padding:0 ">  //////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  ibex_if_stage #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .DmHaltAddr       ( DmHaltAddr      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .DmExceptionAddr  ( DmExceptionAddr )</pre>
<pre id="id301" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) if_stage_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .clk_i                    ( clk                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .rst_ni                   ( rst_ni                 ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .boot_addr_i              ( boot_addr_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .req_i                    ( instr_req_int          ), // instruction request control</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // instruction cache interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_req_o              ( instr_req_out          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_addr_o             ( instr_addr_o           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_gnt_i              ( instr_gnt_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_rvalid_i           ( instr_rvalid_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_rdata_i            ( instr_rdata_i          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_err_i              ( instr_err_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_pmp_err_i          ( pmp_req_err[PMP_I]     ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // outputs to ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_valid_id_o         ( instr_valid_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_new_id_o           ( instr_new_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_rdata_id_o         ( instr_rdata_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_rdata_c_id_o       ( instr_rdata_c_id       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_is_compressed_id_o ( instr_is_compressed_id ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_fetch_err_o        ( instr_fetch_err        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .illegal_c_insn_id_o      ( illegal_c_insn_id      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_if_o                  ( pc_if                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_id_o                  ( pc_id                  ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // control signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_valid_clear_i      ( instr_valid_clear      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_set_i                 ( pc_set                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_mux_i                 ( pc_mux_id              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .exc_pc_mux_i             ( exc_pc_mux_id          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .exc_cause                ( exc_cause              ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // jump targets</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .jump_target_ex_i         ( jump_target_ex         ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // CSRs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mepc_i               ( csr_mepc               ), // exception return address</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_depc_i               ( csr_depc               ), // debug return address</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtvec_i              ( csr_mtvec              ), // trap-vector base address</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtvec_init_o         ( csr_mtvec_init         ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // pipeline stalls</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .id_in_ready_i            ( id_in_ready            ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .if_busy_o                ( if_busy                ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .perf_imiss_o             ( perf_imiss             )</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Qualify the instruction request with PMP error</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign instr_req_o = instr_req_out & ~pmp_req_err[PMP_I];</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  //////////////</pre>
<pre style="margin:0; padding:0 ">  // ID stage //</pre>
<pre style="margin:0; padding:0 ">  //////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  ibex_id_stage #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .RV32E ( RV32E ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .RV32M ( RV32M )</pre>
<pre id="id361" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) id_stage_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .clk_i                        ( clk                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .rst_ni                       ( rst_ni                 ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .test_en_i                    ( test_en_i              ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Processor Enable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .fetch_enable_i               ( fetch_enable_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .ctrl_busy_o                  ( ctrl_busy              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .illegal_insn_o               ( illegal_insn_id        ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // from/to IF-ID pipeline register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_valid_i                ( instr_valid_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_new_i                  ( instr_new_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_rdata_i                ( instr_rdata_id         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_rdata_c_i              ( instr_rdata_c_id       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_is_compressed_i        ( instr_is_compressed_id ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Jumps and branches</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .branch_decision_i            ( branch_decision        ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // IF and ID control signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .id_in_ready_o                ( id_in_ready            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_valid_clear_o          ( instr_valid_clear      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_req_o                  ( instr_req_int          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_set_o                     ( pc_set                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_mux_o                     ( pc_mux_id              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .exc_pc_mux_o                 ( exc_pc_mux_id          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .exc_cause_o                  ( exc_cause              ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_fetch_err_i            ( instr_fetch_err        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .illegal_c_insn_i             ( illegal_c_insn_id      ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_id_i                      ( pc_id                  ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Stalls</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .ex_valid_i                   ( ex_valid               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .lsu_valid_i                  ( lsu_data_valid         ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .alu_operator_ex_o            ( alu_operator_ex        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .alu_operand_a_ex_o           ( alu_operand_a_ex       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .alu_operand_b_ex_o           ( alu_operand_b_ex       ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .mult_en_ex_o                 ( mult_en_ex             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .div_en_ex_o                  ( div_en_ex              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_operator_ex_o        ( multdiv_operator_ex    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_signed_mode_ex_o     ( multdiv_signed_mode_ex ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_operand_a_ex_o       ( multdiv_operand_a_ex   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_operand_b_ex_o       ( multdiv_operand_b_ex   ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // CSR ID/EX</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_access_o                 ( csr_access             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_op_o                     ( csr_op                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_save_if_o                ( csr_save_if            ), // control signal to save PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_save_id_o                ( csr_save_id            ), // control signal to save PC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_restore_mret_id_o        ( csr_restore_mret_id    ), // restore mstatus upon DRET</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_restore_dret_id_o        ( csr_restore_dret_id    ), // restore mstatus upon MRET</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_save_cause_o             ( csr_save_cause         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtval_o                  ( csr_mtval              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .priv_mode_i                  ( priv_mode_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mstatus_tw_i             ( csr_mstatus_tw         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .illegal_csr_insn_i           ( illegal_csr_insn_id    ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // LSU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_req_ex_o                ( data_req_ex            ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_we_ex_o                 ( data_we_ex             ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_type_ex_o               ( data_type_ex           ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_sign_ext_ex_o           ( data_sign_ext_ex       ), // to load store unit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_wdata_ex_o              ( data_wdata_ex          ), // to load store unit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .lsu_addr_incr_req_i          ( lsu_addr_incr_req      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .lsu_addr_last_i              ( lsu_addr_last          ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .lsu_load_err_i               ( lsu_load_err           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .lsu_store_err_i              ( lsu_store_err          ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Interrupt Signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mstatus_mie_i            ( csr_mstatus_mie        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_msip_i                   ( csr_msip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtip_i                   ( csr_mtip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_meip_i                   ( csr_meip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mfip_i                   ( csr_mfip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .irq_pending_i                ( irq_pending            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .irq_nm_i                     ( irq_nm_i               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .nmi_mode_o                   ( nmi_mode               ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Debug Signal</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_mode_o                 ( debug_mode             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_cause_o                ( debug_cause            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_csr_save_o             ( debug_csr_save         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_req_i                  ( debug_req_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_single_step_i          ( debug_single_step      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_ebreakm_i              ( debug_ebreakm          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_ebreaku_i              ( debug_ebreaku          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .trigger_match_i              ( trigger_match          ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // write data to commit in the register file</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .regfile_wdata_lsu_i          ( regfile_wdata_lsu      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .regfile_wdata_ex_i           ( regfile_wdata_ex       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_rdata_i                  ( csr_rdata              ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`ifdef RVFI</pre>
<pre style="margin:0; padding:0 ">      .rfvi_reg_raddr_ra_o          ( rvfi_rs1_addr_id       ),</pre>
<pre style="margin:0; padding:0 ">      .rfvi_reg_rdata_ra_o          ( rvfi_rs1_data_id       ),</pre>
<pre style="margin:0; padding:0 ">      .rfvi_reg_raddr_rb_o          ( rvfi_rs2_addr_id       ),</pre>
<pre style="margin:0; padding:0 ">      .rfvi_reg_rdata_rb_o          ( rvfi_rs2_data_id       ),</pre>
<pre style="margin:0; padding:0 ">      .rfvi_reg_waddr_rd_o          ( rvfi_rd_addr_id        ),</pre>
<pre style="margin:0; padding:0 ">      .rfvi_reg_wdata_rd_o          ( rvfi_rd_wdata_id       ),</pre>
<pre style="margin:0; padding:0 ">      .rfvi_reg_we_o                ( rvfi_rd_we_id          ),</pre>
<pre style="margin:0; padding:0 ">`endif</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Performance Counters</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .perf_jump_o                  ( perf_jump              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .perf_branch_o                ( perf_branch            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .perf_tbranch_o               ( perf_tbranch           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_ret_o                  ( instr_ret              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_ret_compressed_o       ( instr_ret_compressed   )</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // for RVFI only</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign unused_illegal_insn_id = illegal_insn_id;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  ibex_ex_block #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .RV32M                      ( RV32M                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .MultiplierImplementation   ( MultiplierImplementation )</pre>
<pre id="id486" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) ex_block_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .clk_i                      ( clk                      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .rst_ni                     ( rst_ni                   ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // ALU signal from ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .alu_operator_i             ( alu_operator_ex          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .alu_operand_a_i            ( alu_operand_a_ex         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .alu_operand_b_i            ( alu_operand_b_ex         ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Multipler/Divider signal from ID stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_operator_i         ( multdiv_operator_ex      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .mult_en_i                  ( mult_en_ex               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .div_en_i                   ( div_en_ex                ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_signed_mode_i      ( multdiv_signed_mode_ex   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_operand_a_i        ( multdiv_operand_a_ex     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .multdiv_operand_b_i        ( multdiv_operand_b_ex     ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Outputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .alu_adder_result_ex_o      ( alu_adder_result_ex      ), // to LSU</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .regfile_wdata_ex_o         ( regfile_wdata_ex         ), // to ID</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .jump_target_o              ( jump_target_ex           ), // to IF</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .branch_decision_o          ( branch_decision          ), // to ID</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .ex_valid_o                 ( ex_valid                 )</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////</pre>
<pre style="margin:0; padding:0 ">  // Load/store unit //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign data_req_o = data_req_out & ~pmp_req_err[PMP_D];</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  ibex_load_store_unit  load_store_unit_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .clk_i                 ( clk                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .rst_ni                ( rst_ni              ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // data interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_req_o            ( data_req_out        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_gnt_i            ( data_gnt_i          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_rvalid_i         ( data_rvalid_i       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_err_i            ( data_err_i          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_pmp_err_i        ( pmp_req_err[PMP_D]  ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_addr_o           ( data_addr_o         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_we_o             ( data_we_o           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_be_o             ( data_be_o           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_wdata_o          ( data_wdata_o        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_rdata_i          ( data_rdata_i        ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // signals to/from ID/EX stage</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_we_ex_i          ( data_we_ex          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_type_ex_i        ( data_type_ex        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_wdata_ex_i       ( data_wdata_ex       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_sign_ext_ex_i    ( data_sign_ext_ex    ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_rdata_ex_o       ( regfile_wdata_lsu   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_req_ex_i         ( data_req_ex         ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .adder_result_ex_i     ( alu_adder_result_ex ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .addr_incr_req_o       ( lsu_addr_incr_req   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .addr_last_o           ( lsu_addr_last       ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .data_valid_o          ( lsu_data_valid      ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // exception signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .load_err_o            ( lsu_load_err        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .store_err_o           ( lsu_store_err       ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .busy_o                ( lsu_busy            )</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // CSRs (Control and Status Registers) //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign csr_wdata  = alu_operand_a_ex;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign csr_addr   = csr_num_e'(csr_access ? alu_operand_b_ex[11:0] : 12'b0);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign perf_load  = data_req_o & data_gnt_i & (~data_we_o);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign perf_store = data_req_o & data_gnt_i & data_we_o;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CSR access is qualified by instruction fetch error</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign valid_csr_id = instr_new_id & ~instr_fetch_err;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  ibex_cs_registers #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .DbgTriggerEn     ( DbgTriggerEn     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .MHPMCounterNum   ( MHPMCounterNum   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .MHPMCounterWidth ( MHPMCounterWidth ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .PMPEnable        ( PMPEnable        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .PMPGranularity   ( PMPGranularity   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .PMPNumRegions    ( PMPNumRegions    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .RV32E            ( RV32E            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .RV32M            ( RV32M            )</pre>
<pre id="id581" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) cs_registers_i (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .clk_i                   ( clk                    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .rst_ni                  ( rst_ni                 ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Hart ID from outside</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .hart_id_i               ( hart_id_i              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .priv_mode_id_o          ( priv_mode_id           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .priv_mode_if_o          ( priv_mode_if           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .priv_mode_lsu_o         ( priv_mode_lsu          ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // mtvec</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtvec_o             ( csr_mtvec              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtvec_init_i        ( csr_mtvec_init         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .boot_addr_i             ( boot_addr_i            ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Interface to CSRs (SRAM like)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_access_i            ( csr_access             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_addr_i              ( csr_addr               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_wdata_i             ( csr_wdata              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_op_i                ( csr_op                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_rdata_o             ( csr_rdata              ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Interrupt related control signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .irq_software_i          ( irq_software_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .irq_timer_i             ( irq_timer_i            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .irq_external_i          ( irq_external_i         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .irq_fast_i              ( irq_fast_i             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .irq_pending_o           ( irq_pending            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .nmi_mode_i              ( nmi_mode               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_msip_o              ( csr_msip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtip_o              ( csr_mtip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_meip_o              ( csr_meip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mfip_o              ( csr_mfip               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mstatus_mie_o       ( csr_mstatus_mie        ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mstatus_tw_o        ( csr_mstatus_tw         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mepc_o              ( csr_mepc               ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // PMP</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_pmp_cfg_o           ( csr_pmp_cfg            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_pmp_addr_o          ( csr_pmp_addr           ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // debug</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_depc_o              ( csr_depc               ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_mode_i            ( debug_mode             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_cause_i           ( debug_cause            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_csr_save_i        ( debug_csr_save         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_single_step_o     ( debug_single_step      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_ebreakm_o         ( debug_ebreakm          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .debug_ebreaku_o         ( debug_ebreaku          ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .trigger_match_o         ( trigger_match          ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_if_i                 ( pc_if                  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_id_i                 ( pc_id                  ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_save_if_i           ( csr_save_if            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_save_id_i           ( csr_save_id            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_restore_mret_i      ( csr_restore_mret_id    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_restore_dret_i      ( csr_restore_dret_id    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_save_cause_i        ( csr_save_cause         ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mcause_i            ( exc_cause              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .csr_mtval_i             ( csr_mtval              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .illegal_csr_insn_o      ( illegal_csr_insn_id    ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_new_id_i          ( valid_csr_id           ),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // performance counter related signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_ret_i             ( instr_ret              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .instr_ret_compressed_i  ( instr_ret_compressed   ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .imiss_i                 ( perf_imiss             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .pc_set_i                ( pc_set                 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .jump_i                  ( perf_jump              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .branch_i                ( perf_branch            ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .branch_taken_i          ( perf_tbranch           ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .mem_load_i              ( perf_load              ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .mem_store_i             ( perf_store             ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      .lsu_busy_i              ( lsu_busy               )</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre id="id659" style="background-color: #FFB6C1; margin:0; padding:0 ">  if (PMPEnable) begin : g_pmp</pre>
<pre id="id660" style="background-color: #FFB6C1; margin:0; padding:0 ">    logic [33:0] pmp_req_addr [PMP_NUM_CHAN];</pre>
<pre id="id661" style="background-color: #FFB6C1; margin:0; padding:0 ">    pmp_req_e    pmp_req_type [PMP_NUM_CHAN];</pre>
<pre id="id662" style="background-color: #FFB6C1; margin:0; padding:0 ">    priv_lvl_e   pmp_priv_lvl [PMP_NUM_CHAN];</pre>
<pre style="margin:0; padding:0 "></pre>
<pre id="id664" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign pmp_req_addr[PMP_I] = {2'b00,instr_addr_o[31:0]};</pre>
<pre id="id665" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign pmp_req_type[PMP_I] = PMP_ACC_EXEC;</pre>
<pre id="id666" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign pmp_priv_lvl[PMP_I] = priv_mode_if;</pre>
<pre id="id667" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign pmp_req_addr[PMP_D] = {2'b00,data_addr_o[31:0]};</pre>
<pre id="id668" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign pmp_req_type[PMP_D] = data_we_o ? PMP_ACC_WRITE : PMP_ACC_READ;</pre>
<pre id="id669" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign pmp_priv_lvl[PMP_D] = priv_mode_lsu;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre id="id671" style="background-color: #FFB6C1; margin:0; padding:0 ">    ibex_pmp #(</pre>
<pre id="id672" style="background-color: #FFB6C1; margin:0; padding:0 ">        .PMPGranularity        ( PMPGranularity ),</pre>
<pre id="id673" style="background-color: #FFB6C1; margin:0; padding:0 ">        .PMPNumChan            ( PMP_NUM_CHAN   ),</pre>
<pre id="id674" style="background-color: #FFB6C1; margin:0; padding:0 ">        .PMPNumRegions         ( PMPNumRegions  )</pre>
<pre id="id675" style="background-color: #FFB6C1; margin:0; padding:0 ">    ) pmp_i (</pre>
<pre id="id676" style="background-color: #FFB6C1; margin:0; padding:0 ">        .clk_i                 ( clk            ),</pre>
<pre id="id677" style="background-color: #FFB6C1; margin:0; padding:0 ">        .rst_ni                ( rst_ni         ),</pre>
<pre style="margin:0; padding:0 ">        // Interface to CSRs</pre>
<pre id="id679" style="background-color: #FFB6C1; margin:0; padding:0 ">        .csr_pmp_cfg_i         ( csr_pmp_cfg    ),</pre>
<pre id="id680" style="background-color: #FFB6C1; margin:0; padding:0 ">        .csr_pmp_addr_i        ( csr_pmp_addr   ),</pre>
<pre id="id681" style="background-color: #FFB6C1; margin:0; padding:0 ">        .priv_mode_i           ( pmp_priv_lvl   ),</pre>
<pre style="margin:0; padding:0 ">        // Access checking channels</pre>
<pre id="id683" style="background-color: #FFB6C1; margin:0; padding:0 ">        .pmp_req_addr_i        ( pmp_req_addr   ),</pre>
<pre id="id684" style="background-color: #FFB6C1; margin:0; padding:0 ">        .pmp_req_type_i        ( pmp_req_type   ),</pre>
<pre id="id685" style="background-color: #FFB6C1; margin:0; padding:0 ">        .pmp_req_err_o         ( pmp_req_err    )</pre>
<pre style="margin:0; padding:0 ">    );</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  end else begin : g_no_pmp</pre>
<pre style="margin:0; padding:0 ">    // Unused signal tieoff</pre>
<pre id="id689" style="background-color: #FFB6C1; margin:0; padding:0 ">    priv_lvl_e unused_priv_lvl_if, unused_priv_lvl_ls;</pre>
<pre id="id690" style="background-color: #FFB6C1; margin:0; padding:0 ">    logic [33:0] unused_csr_pmp_addr [PMPNumRegions];</pre>
<pre id="id691" style="background-color: #FFB6C1; margin:0; padding:0 ">    pmp_cfg_t    unused_csr_pmp_cfg  [PMPNumRegions];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign unused_priv_lvl_if = priv_mode_if;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign unused_priv_lvl_ls = priv_mode_lsu;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign unused_csr_pmp_addr = csr_pmp_addr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign unused_csr_pmp_cfg = csr_pmp_cfg;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Output tieoff</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign pmp_req_err[PMP_I] = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign pmp_req_err[PMP_D] = 1'b0;</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`ifdef RVFI</pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_halt              <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_trap              <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_intr              <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_order             <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_insn              <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mode              <= {PRIV_LVL_M};</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_addr          <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_addr          <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_pc_rdata          <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_pc_wdata          <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rmask         <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wmask         <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_valid             <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_rdata         <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_rdata         <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_wdata          <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_addr           <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rdata         <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wdata         <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_addr          <= '0;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_halt              <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_trap              <= illegal_insn_id;</pre>
<pre style="margin:0; padding:0 ">      rvfi_intr              <= rvfi_intr_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_order             <= rvfi_order + 64'(rvfi_valid);</pre>
<pre style="margin:0; padding:0 ">      rvfi_insn              <= rvfi_insn_id;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mode              <= {priv_mode_id};</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_addr          <= rvfi_rs1_addr_id;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_addr          <= rvfi_rs2_addr_id;</pre>
<pre style="margin:0; padding:0 ">      rvfi_pc_rdata          <= pc_id;</pre>
<pre style="margin:0; padding:0 ">      rvfi_pc_wdata          <= pc_if;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rmask         <= rvfi_mem_mask_int;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wmask         <= data_we_o ? rvfi_mem_mask_int : 4'b0000;</pre>
<pre style="margin:0; padding:0 ">      rvfi_valid             <= instr_ret;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_rdata         <= rvfi_rs1_data_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_rdata         <= rvfi_rs2_data_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_wdata          <= rvfi_rd_wdata_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_addr           <= rvfi_rd_addr_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rdata         <= rvfi_mem_rdata_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wdata         <= rvfi_mem_wdata_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_addr          <= rvfi_mem_addr_d;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Keep the mem data stable for each instruction cycle</pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="margin:0; padding:0 ">    if (rvfi_insn_new_d && lsu_data_valid) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_addr_d  = alu_adder_result_ex;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rdata_d = regfile_wdata_lsu;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wdata_d = data_wdata_ex;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_addr_d  = rvfi_mem_addr_q;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rdata_d = rvfi_mem_rdata_q;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wdata_d = rvfi_mem_wdata_q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_addr_q  <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rdata_q <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wdata_q <= '0;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_addr_q  <= rvfi_mem_addr_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_rdata_q <= rvfi_mem_rdata_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_mem_wdata_q <= rvfi_mem_wdata_d;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 ">  // Byte enable based on data type</pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="margin:0; padding:0 ">    unique case (data_type_ex)</pre>
<pre style="margin:0; padding:0 ">      2'b00:   rvfi_mem_mask_int = 4'b1111;</pre>
<pre style="margin:0; padding:0 ">      2'b01:   rvfi_mem_mask_int = 4'b0011;</pre>
<pre style="margin:0; padding:0 ">      2'b10:   rvfi_mem_mask_int = 4'b0001;</pre>
<pre style="margin:0; padding:0 ">      default: rvfi_mem_mask_int = 4'b0000;</pre>
<pre style="margin:0; padding:0 ">    endcase</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="margin:0; padding:0 ">    if (instr_is_compressed_id) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_insn_id = {16'b0, instr_rdata_c_id};</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_insn_id = instr_rdata_id;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Source register data are kept stable for each instruction cycle</pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="margin:0; padding:0 ">    if (instr_new_id) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_data_d = rvfi_rs1_data_id;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_data_d = rvfi_rs2_data_id;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_data_d = rvfi_rs1_data_q;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_data_d = rvfi_rs2_data_q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_data_q <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_data_q <= '0;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs1_data_q <= rvfi_rs1_data_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rs2_data_q <= rvfi_rs2_data_d;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // RD write register is refreshed only once per cycle and</pre>
<pre style="margin:0; padding:0 ">  // then it is kept stable for the cycle.</pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="margin:0; padding:0 ">    if (rvfi_insn_new_d) begin</pre>
<pre style="margin:0; padding:0 ">      if (!rvfi_rd_we_id) begin</pre>
<pre style="margin:0; padding:0 ">        rvfi_rd_addr_d    = '0;</pre>
<pre style="margin:0; padding:0 ">        rvfi_rd_wdata_d   = '0;</pre>
<pre style="margin:0; padding:0 ">      end else begin</pre>
<pre style="margin:0; padding:0 ">        rvfi_rd_addr_d = rvfi_rd_addr_id;</pre>
<pre style="margin:0; padding:0 ">        if (rvfi_rd_addr_id == 5'h0) begin</pre>
<pre style="margin:0; padding:0 ">          rvfi_rd_wdata_d = '0;</pre>
<pre style="margin:0; padding:0 ">        end else begin</pre>
<pre style="margin:0; padding:0 ">          rvfi_rd_wdata_d = rvfi_rd_wdata_id;</pre>
<pre style="margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_addr_d    = rvfi_rd_addr_q;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_wdata_d   = rvfi_rd_wdata_q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_addr_q    <= '0;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_wdata_q   <= '0;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_addr_q    <= rvfi_rd_addr_d;</pre>
<pre style="margin:0; padding:0 ">      rvfi_rd_wdata_q   <= rvfi_rd_wdata_d;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="margin:0; padding:0 ">    if (instr_new_id) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_insn_new_d = 1'b1;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_insn_new_d = rvfi_insn_new_q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_insn_new_q <= 1'b0;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      if (instr_ret) begin</pre>
<pre style="margin:0; padding:0 ">        rvfi_insn_new_q <= 1'b0;</pre>
<pre style="margin:0; padding:0 ">      end else begin</pre>
<pre style="margin:0; padding:0 ">        rvfi_insn_new_q <= rvfi_insn_new_d;</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // generate rvfi_intr_d</pre>
<pre style="margin:0; padding:0 ">  assign rvfi_intr_d = rvfi_set_trap_pc_q & rvfi_insn_new_d;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="margin:0; padding:0 ">    rvfi_set_trap_pc_d = rvfi_set_trap_pc_q;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    if (pc_set && pc_mux_id == PC_EXC &&</pre>
<pre style="margin:0; padding:0 ">        (exc_pc_mux_id == EXC_PC_EXC || exc_pc_mux_id == EXC_PC_IRQ)) begin</pre>
<pre style="margin:0; padding:0 ">      // PC is set to enter a trap handler</pre>
<pre style="margin:0; padding:0 ">      rvfi_set_trap_pc_d = 1'b1;</pre>
<pre style="margin:0; padding:0 ">    end else if (rvfi_set_trap_pc_q && instr_ret) begin</pre>
<pre style="margin:0; padding:0 ">      // first instruction has been executed after PC is set to trap handler</pre>
<pre style="margin:0; padding:0 ">      rvfi_set_trap_pc_d = 1'b0;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk or negedge rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_set_trap_pc_q <= 1'b0;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      rvfi_set_trap_pc_q <= rvfi_set_trap_pc_d;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`endif</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
