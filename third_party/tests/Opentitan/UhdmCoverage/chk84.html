
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>hw/ip/usbdev/rtl/usbdev.sv Cov: 98% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// USB Full-Speed Device Interface (usbdev).</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">module usbdev (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       clk_usb_48mhz_i, // use usb_ prefix for signals in this clk</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       rst_usb_ni, // async reset, with relase sync to clk_usb_48_mhz_i</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Register interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  tlul_pkg::tl_h2d_t tl_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output tlul_pkg::tl_d2h_t tl_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // USB Interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       cio_usb_d_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       cio_usb_dp_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       cio_usb_dn_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_d_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_se0_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_dp_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_dn_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_oe_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_tx_mode_se_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic       cio_usb_sense_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_pullup_en_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       cio_usb_suspend_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Interrupts</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_pkt_received_o, // Packet received</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_pkt_sent_o, // Packet sent</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_connected_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_disconnected_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_host_lost_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_link_reset_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_link_suspend_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_link_resume_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_av_empty_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_rx_full_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_av_overflow_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_link_in_err_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_rx_crc_err_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_rx_pid_err_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_rx_bitstuff_err_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic       intr_frame_o</pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  import usbdev_reg_pkg::*;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Could make SramDepth, MaxPktSizeByte, AVFifoDepth and RXFifoDepth</pre>
<pre style="margin:0; padding:0 ">  // module parameters but may need to fix register def for the first two</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int SramDw = 32; // Places packing bytes to SRAM assume this</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int SramDepth = 512; // 2kB, SRAM Width is DW</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int MaxPktSizeByte = 64;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int SramAw = $clog2(SramDepth);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int SizeWidth = $clog2(MaxPktSizeByte);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int NBuf = (SramDepth * SramDw) / (MaxPktSizeByte * 8);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int NBufWidth = $clog2(NBuf);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // AV fifo just stores buffer numbers</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int AVFifoWidth = NBufWidth;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int AVFifoDepth = 4;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // RX fifo stores              buf# +  size(0-MaxPktSizeByte)  + EP# + Type</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int RXFifoWidth = NBufWidth + (1+SizeWidth)         +  4  + 1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int RXFifoDepth = 4;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Number of endpoints</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int NEndpoints = usbdev_reg_pkg::NEndpoints;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  usbdev_reg2hw_t reg2hw;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  usbdev_hw2reg_t hw2reg;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  tlul_pkg::tl_h2d_t tl_sram_h2d [1];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  tlul_pkg::tl_d2h_t tl_sram_d2h [1];</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Dual-port SRAM Interface: Refer prim_ram_2p_wrapper.sv</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              mem_a_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              mem_a_write;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [SramAw-1:0] mem_a_addr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [SramDw-1:0] mem_a_wdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              mem_a_rvalid;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [SramDw-1:0] mem_a_rdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [1:0]        mem_a_rerror;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_mem_b_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_mem_b_write;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [SramAw-1:0] usb_mem_b_addr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [SramDw-1:0] usb_mem_b_wdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [SramDw-1:0] usb_mem_b_rdata;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_clr_devaddr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_event_av_empty, event_av_overflow, usb_event_rx_full;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_av_empty, event_rx_full;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_event_link_reset, usb_event_link_suspend, usb_event_link_resume;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_event_host_lost, usb_event_disconnect, usb_event_connect;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_event_rx_crc_err, usb_event_rx_pid_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_event_rx_bitstuff_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_event_in_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_event_frame;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_link_reset, event_link_suspend, event_link_resume;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_host_lost, event_disconnect, event_connect;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_rx_crc_err, event_rx_pid_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_rx_bitstuff_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_in_err;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_frame;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CDC signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [10:0]       usb_frame;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [2:0]        usb_link_state;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_enable;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [6:0]        usb_device_addr;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic                  usb_data_toggle_clear_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NEndpoints-1:0] usb_data_toggle_clear;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // USB IO after CDC & muxing   //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic usb_rx_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic usb_rx_se0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic usb_tx_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic usb_tx_se0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic usb_tx_oe;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic usb_pwr_sense;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic usb_pullup_en;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // Receive interface fifos //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              av_fifo_wready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              event_pkt_received;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_av_rvalid, usb_av_rready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              usb_rx_wvalid, usb_rx_wready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic              rx_fifo_rvalid;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [AVFifoWidth - 1:0] usb_av_rdata;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [RXFifoWidth - 1:0] usb_rx_wdata, rx_rdata_raw, rx_rdata;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign event_av_overflow = reg2hw.avbuffer.qe & (~av_fifo_wready);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.usbstat.av_full.d = ~av_fifo_wready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.usbstat.rx_empty.d = ~rx_fifo_rvalid;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_fifo_async #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width(AVFifoWidth),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Depth(AVFifoDepth)</pre>
<pre id="id158" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) usbdev_avfifo (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_wr_i  (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_wr_ni (rst_ni),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wvalid    (reg2hw.avbuffer.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wready    (av_fifo_wready),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wdata     (reg2hw.avbuffer.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wdepth    (hw2reg.usbstat.av_depth.d),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_rd_i  (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_rd_ni (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rvalid    (usb_av_rvalid),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rready    (usb_av_rready),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rdata     (usb_av_rdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rdepth    () // only using empty</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_fifo_async #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width(RXFifoWidth),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Depth(RXFifoDepth)</pre>
<pre id="id178" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) usbdev_rxfifo (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_wr_i  (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_wr_ni (rst_usb_ni),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wvalid    (usb_rx_wvalid),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wready    (usb_rx_wready),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wdata     (usb_rx_wdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wdepth    (),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_rd_i  (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_rd_ni (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rvalid    (rx_fifo_rvalid),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rready    (reg2hw.rxfifo.buffer.re),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rdata     (rx_rdata_raw),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rdepth    (hw2reg.usbstat.rx_depth.d)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Return all zero if the FIFO is empty (instead of X)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign rx_rdata = rx_fifo_rvalid ? rx_rdata_raw : '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.rxfifo.ep.d = rx_rdata[16:13];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.rxfifo.setup.d = rx_rdata[12];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.rxfifo.size.d = rx_rdata[11:5];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.rxfifo.buffer.d = rx_rdata[4:0];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign event_pkt_received = rx_fifo_rvalid;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [2:0]               unused_re;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign unused_re = {reg2hw.rxfifo.ep.re, reg2hw.rxfifo.setup.re, reg2hw.rxfifo.size.re};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // IN (Transmit) interface config //</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////////////</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NBufWidth-1:0]  usb_in_buf [NEndpoints];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [SizeWidth:0]    usb_in_size [NEndpoints];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [3:0]            usb_in_endpoint;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NEndpoints-1:0] usb_in_rdy;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NEndpoints-1:0] clear_rdybit, set_sentbit, update_pend;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic                  usb_setup_received, setup_received, usb_set_sent, set_sent;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NEndpoints-1:0] ep_iso;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NEndpoints-1:0] enable_setup, enable_out, ep_stall;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NEndpoints-1:0] usb_enable_setup, usb_enable_out, usb_ep_stall;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NEndpoints-1:0] in_rdy_async;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [3:0]            usb_out_endpoint;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // RX enables</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_rxenable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      enable_setup[i] = reg2hw.rxenable_setup[i].q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      enable_out[i]   = reg2hw.rxenable_out[i].q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // STALL for both directions</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_stall</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      ep_stall[i] = reg2hw.stall[i];</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_flop_2sync #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width(3*NEndpoints)</pre>
<pre id="id237" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) usbdev_sync_ep_cfg (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i  (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .d      ({enable_setup, enable_out, ep_stall}),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .q      ({usb_enable_setup, usb_enable_out, usb_ep_stall})</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CDC: ok, quasi-static</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_iso</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      ep_iso[i] = reg2hw.iso[i].q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CDC: flop_2sync for ready bit covers others so assigns are ok</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_buf_size</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      usb_in_buf[i]  = reg2hw.configin[i].buffer.q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      usb_in_size[i] = reg2hw.configin[i].size.q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_rdy_reg2hw</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      in_rdy_async[i] = reg2hw.configin[i].rdy.q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_flop_2sync #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width (NEndpoints)</pre>
<pre id="id267" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) usbdev_rdysync (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i  (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .d      (in_rdy_async),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .q      (usb_in_rdy)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CDC: We synchronize the qe (write pulse) and assume that the</pre>
<pre style="margin:0; padding:0 ">  // rest of the register remains stable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync usbdev_data_toggle_clear (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (reg2hw.data_toggle_clear[0].qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (usb_data_toggle_clear_en)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_usb_data_toggle_clear</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    usb_data_toggle_clear = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      if (usb_data_toggle_clear_en) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        usb_data_toggle_clear[i] = reg2hw.data_toggle_clear[i].q;</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Clear of ready and set of sent is a pulse in USB clock domain</pre>
<pre style="margin:0; padding:0 ">  // but needs to ensure register bit is cleared/set in TLUL domain</pre>
<pre style="margin:0; padding:0 ">  // usbdev_pulsesync takes pulse in clk_src to pulse in clk_dst</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync usbdev_setsent (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_set_sent),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (set_sent)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    set_sentbit = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (set_sent) begin</pre>
<pre style="margin:0; padding:0 ">      // synchronization of set_sent ensures usb_endpoint is stable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      set_sentbit[usb_in_endpoint] = 1; // lint: usb_in_endpoint range was checked</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_sent</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      hw2reg.in_sent[i].de = set_sentbit[i];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      hw2reg.in_sent[i].d  = 1'b1;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Event (pulse) synchronization</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync usbdev_sync_in_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_in_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_in_err)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync usbdev_outrdyclr (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_setup_received),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (setup_received)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync sync_usb_event_rx_crc_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_rx_crc_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_rx_crc_err)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync sync_usb_event_rx_pid_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_rx_pid_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_rx_pid_err)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync sync_usb_event_rx_bitstuff_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_rx_bitstuff_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_rx_bitstuff_err)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync sync_usb_event_frame (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_frame),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_frame)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic event_link_reset_q;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_ff @(posedge clk_usb_48mhz_i or negedge rst_usb_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_usb_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      event_link_reset_q <= 0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      event_link_reset_q <= event_link_reset;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    clear_rdybit = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    update_pend  = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (event_link_reset && !event_link_reset_q) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      clear_rdybit = {NEndpoints{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      update_pend  = {NEndpoints{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else begin</pre>
<pre style="margin:0; padding:0 ">      // Clear pending when a SETUP is received</pre>
<pre style="margin:0; padding:0 ">      // CDC: usb_out_endpoint is synchronized implicitly by</pre>
<pre style="margin:0; padding:0 ">      // setup_received, as it is stable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      clear_rdybit[usb_out_endpoint] = setup_received;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      update_pend[usb_out_endpoint]  = setup_received;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Clear when a IN transmission was sucessful</pre>
<pre style="margin:0; padding:0 ">      // CDC: usb_in_endpoint is synchronzied implicitly by</pre>
<pre style="margin:0; padding:0 ">      // set_sent</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      clear_rdybit[usb_in_endpoint] = set_sent;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_rdy_hw2reg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      hw2reg.configin[i].rdy.de = clear_rdybit[i];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      hw2reg.configin[i].rdy.d  = 1'b0;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Update the pending bit by copying the ready bit that is about to clear</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_map_pend</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      hw2reg.configin[i].pend.de = update_pend[i];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      hw2reg.configin[i].pend.d  = reg2hw.configin[i].rdy.q | reg2hw.configin[i].pend.q;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // USB interface -- everything is in USB clock domain //</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  usbdev_usbif #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .NEndpoints     (NEndpoints),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .AVFifoWidth    (AVFifoWidth),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .RXFifoWidth    (RXFifoWidth),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .MaxPktSizeByte (MaxPktSizeByte),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .NBuf           (NBuf),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .SramAw         (SramAw)</pre>
<pre id="id432" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) usbdev_impl (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_48mhz_i          (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni               (rst_usb_ni),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Pins</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_d_i              (usb_rx_d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_se0_i            (usb_rx_se0),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_oe_o             (usb_tx_oe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_d_o              (usb_tx_d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_se0_o            (usb_tx_se0),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_sense_i          (usb_pwr_sense),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_pullup_en_o      (usb_pullup_en),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // receive side</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_setup_i           (usb_enable_setup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_out_i             (usb_enable_out),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_stall_i           (usb_ep_stall),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .av_rvalid_i          (usb_av_rvalid),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .av_rready_o          (usb_av_rready),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .av_rdata_i           (usb_av_rdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_av_empty_o     (usb_event_av_empty),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_wvalid_o          (usb_rx_wvalid),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_wready_i          (usb_rx_wready),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_wdata_o           (usb_rx_wdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_rx_full_o      (usb_event_rx_full),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .setup_received_o     (usb_setup_received),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .out_endpoint_o       (usb_out_endpoint),  // will be stable for several cycles</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // transmit side</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .in_buf_i             (usb_in_buf[usb_in_endpoint]),  // lint: usb_in_endpoint range was checked</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .in_size_i            (usb_in_size[usb_in_endpoint]),  // lint: usb_in_endpoint range was checked</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .in_stall_i           (usb_ep_stall),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .in_rdy_i             (usb_in_rdy),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .set_sent_o           (usb_set_sent),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .in_endpoint_o        (usb_in_endpoint),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // memory</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .mem_req_o            (usb_mem_b_req),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .mem_write_o          (usb_mem_b_write),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .mem_addr_o           (usb_mem_b_addr),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .mem_wdata_o          (usb_mem_b_wdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .mem_rdata_i          (usb_mem_b_rdata),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .enable_i             (usb_enable),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .devaddr_i            (usb_device_addr),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clr_devaddr_o        (usb_clr_devaddr),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ep_iso_i             (ep_iso), // cdc ok, quasi-static</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cfg_eop_single_bit_i (reg2hw.phy_config.eop_single_bit.q), // cdc ok: quasi-static</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tx_osc_test_mode_i   (1'b0), // cdc ok: quasi-static & testmode only</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .data_toggle_clear_i  (usb_data_toggle_clear),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // status</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .frame_o              (usb_frame),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .frame_start_o        (usb_event_frame),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .link_state_o         (usb_link_state),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .link_disconnect_o    (usb_event_disconnect),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .link_connect_o       (usb_event_connect),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .link_reset_o         (usb_event_link_reset),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .link_suspend_o       (usb_event_link_suspend),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .link_resume_o        (usb_event_link_resume),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .host_lost_o          (usb_event_host_lost),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .link_in_err_o        (usb_event_in_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_crc_err_o         (usb_event_rx_crc_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_pid_err_o         (usb_event_rx_pid_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_bitstuff_err_o    (usb_event_rx_bitstuff_err)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // Control signal / status CDC //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // USB clk -> sys clk</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_flop_2sync #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width      (3+11)</pre>
<pre id="id508" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) cdc_usb_to_sys (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i  (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .d      ({usb_link_state,              usb_frame}),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .q      ({hw2reg.usbstat.link_state.d, hw2reg.usbstat.frame.d})</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // sys clk -> USB clk</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_flop_2sync #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width      (1+7)</pre>
<pre id="id518" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) cdc_sys_to_usb (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i  (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .d      ({reg2hw.usbctrl.enable.q, reg2hw.usbctrl.device_address.q}),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .q      ({usb_enable,              usb_device_addr})</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CDC for event signals (arguably they are there for a long time so would be ok)</pre>
<pre style="margin:0; padding:0 ">  // Just want a pulse to ensure only one interrupt for an event</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  usbdev_flop_2syncpulse #(.Width(5)) syncevent (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i  (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .d      ({usb_event_disconnect, usb_event_link_reset, usb_event_link_suspend,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">              usb_event_host_lost, usb_event_connect}),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .q      ({event_disconnect, event_link_reset, event_link_suspend,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">              event_host_lost, event_connect})</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Resume is a single pulse so needs pulsesync</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync usbdev_resume (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_link_resume),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_link_resume)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.usbstat.host_lost.d = event_host_lost;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // resets etc cause the device address to clear</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync usbdev_devclr (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_clr_devaddr),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (hw2reg.usbctrl.device_address.de)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.usbctrl.device_address.d = '0;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // AV empty is a single pulse so needs pulsesync</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync sync_usb_event_av_empty (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_av_empty),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_av_empty)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // RX full is a single pulse so needs pulsesync</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_pulse_sync sync_usb_event_rx_full (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_src_i   (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_dst_i   (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_src_ni  (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_dst_ni  (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .src_pulse_i (usb_event_rx_full),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .dst_pulse_o (event_rx_full)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Clear the stall flag when a SETUP is received</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // CDC: usb_out_endpoint is synchronized implicitly by</pre>
<pre style="margin:0; padding:0 ">  // setup_received, as it is stable</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_comb begin : proc_stall_tieoff</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int i = 0; i < NEndpoints; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      hw2reg.stall[i].d  = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      if (setup_received && usb_out_endpoint == 4'(i)) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        hw2reg.stall[i].de = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        hw2reg.stall[i].de = 1'b0;</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic        unused_mem_a_rerror_d;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // TL-UL to SRAM adapter</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  tlul_adapter_sram #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .SramAw(SramAw),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ByteAccess(0)</pre>
<pre id="id600" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) u_tlul2sram (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i    (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni   (rst_ni),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_i     (tl_sram_h2d [0]),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_o     (tl_sram_d2h [0]),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .req_o    (mem_a_req),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .gnt_i    (mem_a_req),  //Always grant when request</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .we_o     (mem_a_write),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .addr_o   (mem_a_addr),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wdata_o  (mem_a_wdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wmask_o  (),           // Not used</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rdata_i  (mem_a_rdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rvalid_i (mem_a_rvalid),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rerror_i (mem_a_rerror)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign unused_mem_a_rerror_d = mem_a_rerror[1] ; // Only uncorrectable error</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // SRAM Wrapper</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_ram_2p_async_adv #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Depth (SramDepth),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width (SramDw),    // 32 x 512 --> 2kB</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .CfgW  (8),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .EnableECC           (0), // No Protection</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .EnableParity        (0),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .EnableInputPipeline (0),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .EnableOutputPipeline(0),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // large memory, implement with SRAMs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .MemT ("SRAM")</pre>
<pre id="id633" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) u_memory_2p (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_a_i    (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_b_i    (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_a_ni   (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_b_ni   (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .a_req_i    (mem_a_req),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .a_write_i  (mem_a_write),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .a_addr_i   (mem_a_addr),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .a_wdata_i  (mem_a_wdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .a_rvalid_o (mem_a_rvalid),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .a_rdata_o  (mem_a_rdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .a_rerror_o (mem_a_rerror),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .b_req_i    (usb_mem_b_req),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .b_write_i  (usb_mem_b_write),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .b_addr_i   (usb_mem_b_addr),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .b_wdata_i  (usb_mem_b_wdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .b_rvalid_o (),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .b_rdata_o  (usb_mem_b_rdata),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .b_rerror_o (),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cfg_i      (8'h0)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Register module</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  usbdev_reg_top u_reg (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_i (tl_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_o (tl_o),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_win_o (tl_sram_h2d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_win_i (tl_sram_d2h),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .devmode_i (1'b1)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_hw_pkt_received (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_pkt_received),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.pkt_received.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.pkt_received.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.pkt_received.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.pkt_received.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.pkt_received.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.pkt_received.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_pkt_received_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_hw_pkt_sent (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (set_sent),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.pkt_sent.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.pkt_sent.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.pkt_sent.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.pkt_sent.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.pkt_sent.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.pkt_sent.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_pkt_sent_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_disconnected (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_disconnect),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.disconnected.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.disconnected.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.disconnected.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.disconnected.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.disconnected.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.disconnected.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_disconnected_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_connected (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_connect),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.connected.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.connected.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.connected.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.connected.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.connected.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.connected.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_connected_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_host_lost (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_host_lost),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.host_lost.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.host_lost.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.host_lost.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.host_lost.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.host_lost.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.host_lost.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_host_lost_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_link_reset (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_link_reset),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.link_reset.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.link_reset.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.link_reset.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.link_reset.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.link_reset.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.link_reset.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_link_reset_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_link_suspend (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_link_suspend),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.link_suspend.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.link_suspend.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.link_suspend.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.link_suspend.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.link_suspend.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.link_suspend.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_link_suspend_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_link_resume (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_link_resume),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.link_resume.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.link_resume.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.link_resume.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.link_resume.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.link_resume.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.link_resume.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_link_resume_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_av_empty (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_av_empty),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.av_empty.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.av_empty.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.av_empty.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.av_empty.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.av_empty.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.av_empty.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_av_empty_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_rx_full (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_rx_full),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.rx_full.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.rx_full.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.rx_full.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.rx_full.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.rx_full.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.rx_full.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_rx_full_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_av_overflow (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_av_overflow),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.av_overflow.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.av_overflow.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.av_overflow.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.av_overflow.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.av_overflow.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.av_overflow.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_av_overflow_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_link_in_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_in_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.link_in_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.link_in_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.link_in_err.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.link_in_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.link_in_err.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.link_in_err.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_link_in_err_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_rx_crc_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_rx_crc_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.rx_crc_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.rx_crc_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.rx_crc_err.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.rx_crc_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.rx_crc_err.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.rx_crc_err.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_rx_crc_err_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_rx_pid_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_rx_pid_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.rx_pid_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.rx_pid_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.rx_pid_err.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.rx_pid_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.rx_pid_err.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.rx_pid_err.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_rx_pid_err_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_rx_bitstuff_err (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_rx_bitstuff_err),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.rx_bitstuff_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.rx_bitstuff_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.rx_bitstuff_err.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.rx_bitstuff_err.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.rx_bitstuff_err.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.rx_bitstuff_err.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_rx_bitstuff_err_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_frame (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (event_frame),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.frame.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.frame.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.frame.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.frame.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.frame.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.frame.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_frame_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // USB IO Muxing               //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  usbdev_iomux i_usbdev_iomux (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i                  (clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni                 (rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_usb_48mhz_i        (clk_usb_48mhz_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_usb_ni             (rst_usb_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rx_differential_mode_i (reg2hw.phy_config.rx_differential_mode),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tx_differential_mode_i (reg2hw.phy_config.tx_differential_mode),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .sys_reg2hw_config_i    (reg2hw.phy_config),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .sys_usb_sense_o        (hw2reg.usbstat.usb_sense.d),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Chip IO</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_d_i            (cio_usb_d_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_dp_i           (cio_usb_dp_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_dn_i           (cio_usb_dn_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_d_o            (cio_usb_d_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_se0_o          (cio_usb_se0_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_dp_o           (cio_usb_dp_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_dn_o           (cio_usb_dn_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_oe_o           (cio_usb_oe_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_tx_mode_se_o   (cio_usb_tx_mode_se_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_sense_i        (cio_usb_sense_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_pullup_en_o    (cio_usb_pullup_en_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cio_usb_suspend_o      (cio_usb_suspend_o),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // Internal interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_rx_d_o             (usb_rx_d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_rx_se0_o           (usb_rx_se0),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_tx_d_i             (usb_tx_d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_tx_se0_i           (usb_tx_se0),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_tx_oe_i            (usb_tx_oe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_pwr_sense_o        (usb_pwr_sense),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_pullup_en_i        (usb_pullup_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .usb_suspend_i          (usb_event_link_suspend)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
