
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_padctrl_component_0.1/rtl/padctrl.sv Cov: 86% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// This it the padctrl portion that has to be placed into the toplevel.</pre>
<pre style="margin:0; padding:0 ">// It basically just wraps the regfile and outputs the configuration bits</pre>
<pre style="margin:0; padding:0 ">// to be consumed on the chiplevel.</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`ifndef PRIM_DEFAULT_IMPL</pre>
<pre style="margin:0; padding:0 ">  `define PRIM_DEFAULT_IMPL prim_pkg::ImplGeneric</pre>
<pre style="margin:0; padding:0 ">`endif</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">module padctrl import padctrl_reg_pkg::*; #(</pre>
<pre style="margin:0; padding:0 ">  parameter prim_pkg::impl_e Impl = `PRIM_DEFAULT_IMPL</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">) (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input                                  clk_i,</pre>
<pre style="margin:0; padding:0 ">  input                                  rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  // Bus Interface (device)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  tlul_pkg::tl_h2d_t              tl_i,</pre>
<pre style="margin:0; padding:0 ">  output tlul_pkg::tl_d2h_t              tl_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  // pad attributes to chip level instance</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic[NMioPads-1:0][AttrDw-1:0] mio_attr_o,</pre>
<pre style="margin:0; padding:0 ">  output logic[NDioPads-1:0][AttrDw-1:0] dio_attr_o</pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  //////////////////</pre>
<pre style="margin:0; padding:0 ">  // WARL Control //</pre>
<pre style="margin:0; padding:0 ">  //////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // This controls the WARL'ness of the CSRs</pre>
<pre style="margin:0; padding:0 ">  // needs to be in line with the corresponding</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  // prim_pad_wrapper implementation</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [AttrDw-1:0] warl_mask;</pre>
<pre style="margin:0; padding:0 ">  if (Impl == prim_pkg::ImplGeneric) begin : gen_generic</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    // all attributes supported</pre>
<pre id="id39" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign warl_mask = AttrDw'(6'h3F);</pre>
<pre style="margin:0; padding:0 ">  end else if (Impl == prim_pkg::ImplXilinx) begin : gen_xilinx</pre>
<pre id="id41" style="background-color: #FFB6C1; margin:0; padding:0 ">    // only OD and INV supported</pre>
<pre id="id42" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign warl_mask = AttrDw'(2'h3);</pre>
<pre style="margin:0; padding:0 ">  end else begin : gen_others</pre>
<pre id="id44" style="background-color: #FFB6C1; margin:0; padding:0 ">    // all attributes supported</pre>
<pre style="margin:0; padding:0 ">    assign warl_mask = AttrDw'(6'h3F);</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////</pre>
<pre style="margin:0; padding:0 ">  // Regfile //</pre>
<pre style="margin:0; padding:0 ">  /////////////</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  padctrl_reg2hw_t reg2hw;</pre>
<pre style="margin:0; padding:0 ">  padctrl_hw2reg_t hw2reg;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  padctrl_reg_top i_reg_top (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i  ,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni ,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_i   ,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_o   ,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw ,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg ,</pre>
<pre style="margin:0; padding:0 ">    .devmode_i(1'b1)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////</pre>
<pre style="margin:0; padding:0 ">  // HWEXT Regs //</pre>
<pre style="margin:0; padding:0 ">  ////////////////</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [NDioPads-1:0][AttrDw-1:0] dio_attr_q;</pre>
<pre style="margin:0; padding:0 ">  logic [NMioPads-1:0][AttrDw-1:0] mio_attr_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_ff @(posedge clk_i or negedge rst_ni) begin : p_regs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      dio_attr_q <= '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      mio_attr_q <= '0;</pre>
<pre style="margin:0; padding:0 ">    end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      // dedicated pads</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      for (int kk = 0; kk < NDioPads; kk++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        if (reg2hw.dio_pads[kk].qe) begin</pre>
<pre style="margin:0; padding:0 ">          dio_attr_q[kk] <= reg2hw.dio_pads[kk].q;</pre>
<pre style="margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      // muxed pads</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      for (int kk = 0; kk < NMioPads; kk++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        if (reg2hw.mio_pads[kk].qe) begin</pre>
<pre style="margin:0; padding:0 ">          mio_attr_q[kk] <= reg2hw.mio_pads[kk].q;</pre>
<pre style="margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////</pre>
<pre id="id93" style="background-color: #FFB6C1; margin:0; padding:0 ">  // Connect attributes //</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // using the warl_mask here instead instead of in the register assignment above</pre>
<pre style="margin:0; padding:0 ">  // avoids lint errors. the unused registers can be removed automatically by most tools.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  for (genvar k = 0; k < NDioPads; k++) begin : gen_dio_attr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign dio_attr_o[k]        = dio_attr_q[k] & warl_mask;</pre>
<pre style="margin:0; padding:0 ">    assign hw2reg.dio_pads[k].d = dio_attr_q[k] & warl_mask;</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  for (genvar k = 0; k < NMioPads; k++) begin : gen_mio_attr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign mio_attr_o[k]        = mio_attr_q[k] & warl_mask;</pre>
<pre style="margin:0; padding:0 ">    assign hw2reg.mio_pads[k].d = mio_attr_q[k] & warl_mask;</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////</pre>
<pre style="margin:0; padding:0 ">  // Assertions //</pre>
<pre style="margin:0; padding:0 ">  ////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  `ASSERT_KNOWN(TlDValidKnownO_A, tl_o.d_valid)</pre>
<pre style="margin:0; padding:0 ">  `ASSERT_KNOWN(TlAReadyKnownO_A, tl_o.a_ready)</pre>
<pre style="margin:0; padding:0 ">  `ASSERT_KNOWN(MioKnownO_A, mio_attr_o)</pre>
<pre style="margin:0; padding:0 ">  `ASSERT_KNOWN(DioKnownO_A, dio_attr_o)</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule : padctrl</pre>
<pre id="id118" style="background-color: #FFB6C1; margin:0; padding:0 "></pre>
</body>
</html>
