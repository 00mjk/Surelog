
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_prim_ram_1p_adv_0.1/rtl/prim_ram_1p_adv.sv Cov: 61% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// Single-Port SRAM Wrapper</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// Supported configurations:</pre>
<pre style="margin:0; padding:0 ">// - ECC for 32b wide memories with no write mask</pre>
<pre style="margin:0; padding:0 ">//   (Width == 32 && DataBitsPerMask == 32).</pre>
<pre style="margin:0; padding:0 ">// - Byte parity if Width is a multiple of 8 bit and write masks have Byte</pre>
<pre style="margin:0; padding:0 ">//   granularity (DataBitsPerMask == 8).</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// Note that the write mask needs to be per Byte if parity is enabled. If ECC is enabled, the write</pre>
<pre style="margin:0; padding:0 ">// mask cannot be used and has to be tied to {Width{1'b1}}.</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 ">`include "prim_util.svh"</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">module prim_ram_1p_adv #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  int Depth                = 512,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  int Width                = 32,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  int DataBitsPerMask      = 1,  // Number of data bits per bit of write mask</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  int CfgW                 = 8,  // WTC, RTC, etc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter      MemInitFile          = "", // VMEM file to initialize the memory with</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Configurations</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  bit EnableECC            = 0, // Enables per-word ECC</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  bit EnableParity         = 0, // Enables per-Byte Parity</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  bit EnableInputPipeline  = 0, // Adds an input register (read latency +1)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter  bit EnableOutputPipeline = 0, // Adds an output register (read latency +1)</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int Aw                   = vbits(Depth)</pre>
<pre style="margin:0; padding:0 ">) (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input rst_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input                      req_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input                      write_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input        [Aw-1:0]      addr_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input        [Width-1:0]   wdata_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input        [Width-1:0]   wmask_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic [Width-1:0]   rdata_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic               rvalid_o, // read response (rdata_o) is valid</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic [1:0]         rerror_o, // Bit1: Uncorrectable, Bit0: Correctable</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // config</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input [CfgW-1:0] cfg_i</pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  `ASSERT_INIT(CannotHaveEccAndParity_A, !(EnableParity && EnableECC))</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // While we require DataBitsPerMask to be per Byte (8) at the interface in case Byte parity is</pre>
<pre style="margin:0; padding:0 ">  // enabled, we need to switch this to a per-bit mask locally such that we can individually enable</pre>
<pre style="margin:0; padding:0 ">  // the parity bits to be written alongside the data.</pre>
<pre style="margin:0; padding:0 ">  localparam int LocalDataBitsPerMask = (EnableParity) ? 1 : DataBitsPerMask;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Calculate ECC width</pre>
<pre style="margin:0; padding:0 ">  localparam int ParWidth  = (EnableParity) ? Width/8 :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                             (!EnableECC)   ? 0 :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                             (Width <=   4) ? 4 :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                             (Width <=  11) ? 5 :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                             (Width <=  26) ? 6 :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                             (Width <=  57) ? 7 :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                             (Width <= 120) ? 8 : 8 ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int TotalWidth = Width + ParWidth;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre id="id68" style="background-color: #FFB6C1; margin:0; padding:0 ">  // RAM Primitive Instance //</pre>
<pre id="id69" style="background-color: #FFB6C1; margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  logic                    req_q,    req_d ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic                    write_q,  write_d ;</pre>
<pre style="margin:0; padding:0 ">  logic [Aw-1:0]           addr_q,   addr_d ;</pre>
<pre style="margin:0; padding:0 ">  logic [TotalWidth-1:0]   wdata_q,  wdata_d ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [TotalWidth-1:0]   wmask_q,  wmask_d ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic                    rvalid_q, rvalid_d, rvalid_sram ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [Width-1:0]        rdata_q,  rdata_d ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [TotalWidth-1:0]   rdata_sram ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [1:0]              rerror_q, rerror_d ;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  prim_ram_1p #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .MemInitFile     (MemInitFile),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    .Width           (TotalWidth),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Depth           (Depth),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .DataBitsPerMask (LocalDataBitsPerMask)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  ) u_mem (</pre>
<pre id="id88" style="background-color: #FFB6C1; margin:0; padding:0 ">    .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    .req_i    (req_q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .write_i  (write_q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .addr_i   (addr_q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wdata_i  (wdata_q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wmask_i  (wmask_q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rdata_o  (rdata_sram)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      rvalid_sram <= 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      rvalid_sram <= req_q & ~write_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  assign req_d              = req_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign write_d            = write_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign addr_d             = addr_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign rvalid_o           = rvalid_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign rdata_o            = rdata_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign rerror_o           = rerror_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // ECC / Parity Generation //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  if (EnableParity == 0 && EnableECC) begin : gen_secded</pre>
<pre id="id118" style="background-color: #FFB6C1; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // check supported widths</pre>
<pre style="margin:0; padding:0 ">    `ASSERT_INIT(SecDecWidth_A, Width inside {32})</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // the wmask is constantly set to 1 in this case</pre>
<pre style="margin:0; padding:0 ">    `ASSERT(OnlyWordWritePossibleWithEccPortA_A, req_i |-></pre>
<pre style="margin:0; padding:0 ">          wmask_i == {TotalWidth{1'b1}})</pre>
<pre style="margin:0; padding:0 "></pre>
<pre id="id126" style="background-color: #FFB6C1; margin:0; padding:0 ">    assign wmask_d = {TotalWidth{1'b1}};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre id="id128" style="background-color: #FFB6C1; margin:0; padding:0 ">    if (Width == 32) begin : gen_secded_39_32</pre>
<pre id="id129" style="background-color: #FFB6C1; margin:0; padding:0 ">      prim_secded_39_32_enc u_enc (.in(wdata_i), .out(wdata_d));</pre>
<pre id="id130" style="background-color: #FFB6C1; margin:0; padding:0 ">      prim_secded_39_32_dec u_dec (</pre>
<pre id="id131" style="background-color: #FFB6C1; margin:0; padding:0 ">        .in         (rdata_sram),</pre>
<pre id="id132" style="background-color: #FFB6C1; margin:0; padding:0 ">        .d_o        (rdata_d[0+:Width]),</pre>
<pre id="id133" style="background-color: #FFB6C1; margin:0; padding:0 ">        .syndrome_o ( ),</pre>
<pre id="id134" style="background-color: #FFB6C1; margin:0; padding:0 ">        .err_o      (rerror_d)</pre>
<pre style="margin:0; padding:0 ">      );</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre id="id137" style="background-color: #FFB6C1; margin:0; padding:0 ">  end else if (EnableParity) begin : gen_byte_parity</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    `ASSERT_INIT(WidthNeedsToBeByteAligned_A, Width % 8 == 0)</pre>
<pre style="margin:0; padding:0 ">    `ASSERT_INIT(ParityNeedsByteWriteMask_A, DataBitsPerMask == 8)</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    always_comb begin : p_parity</pre>
<pre id="id143" style="background-color: #FFB6C1; margin:0; padding:0 ">      rerror_d = '0;</pre>
<pre id="id144" style="background-color: #FFB6C1; margin:0; padding:0 ">      wmask_d[0+:Width] = wmask_i;</pre>
<pre id="id145" style="background-color: #FFB6C1; margin:0; padding:0 ">      wdata_d[0+:Width] = wdata_i;</pre>
<pre id="id146" style="background-color: #FFB6C1; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      for (int i = 0; i < Width/8; i ++) begin</pre>
<pre id="id148" style="background-color: #FFB6C1; margin:0; padding:0 ">        // parity generation (odd parity)</pre>
<pre style="margin:0; padding:0 ">        wdata_d[Width + i] = ~(^wdata_i[i*8 +: 8]);</pre>
<pre id="id150" style="background-color: #FFB6C1; margin:0; padding:0 ">        wmask_d[Width + i] = &wmask_i[i*8 +: 8];</pre>
<pre id="id151" style="background-color: #FFB6C1; margin:0; padding:0 ">        // parity decoding (errors are always uncorrectable)</pre>
<pre style="margin:0; padding:0 ">        rerror_d[1] |= ~(^{rdata_sram[i*8 +: 8], rdata_sram[Width + i]});</pre>
<pre id="id153" style="background-color: #FFB6C1; margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">      // tie to zero if the read data is not valid</pre>
<pre style="margin:0; padding:0 ">      rerror_d &= {2{rvalid_sram}};</pre>
<pre id="id156" style="background-color: #FFB6C1; margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    assign rdata_d  = rdata_sram[0+:Width];</pre>
<pre id="id159" style="background-color: #FFB6C1; margin:0; padding:0 ">  end else begin : gen_nosecded_noparity</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign wmask_d = wmask_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign wdata_d = wdata_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    assign rdata_d  = rdata_sram[0+:Width];</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign rerror_d = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  assign rvalid_d = rvalid_sram;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // Input/Output Pipeline Registers //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  if (EnableInputPipeline) begin : gen_regslice_input</pre>
<pre id="id174" style="background-color: #FFB6C1; margin:0; padding:0 ">    // Put the register slices between ECC encoding to SRAM port</pre>
<pre style="margin:0; padding:0 ">    always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre id="id176" style="background-color: #FFB6C1; margin:0; padding:0 ">      if (!rst_ni) begin</pre>
<pre id="id177" style="background-color: #FFB6C1; margin:0; padding:0 ">        req_q   <= '0;</pre>
<pre id="id178" style="background-color: #FFB6C1; margin:0; padding:0 ">        write_q <= '0;</pre>
<pre id="id179" style="background-color: #FFB6C1; margin:0; padding:0 ">        addr_q  <= '0;</pre>
<pre id="id180" style="background-color: #FFB6C1; margin:0; padding:0 ">        wdata_q <= '0;</pre>
<pre id="id181" style="background-color: #FFB6C1; margin:0; padding:0 ">        wmask_q <= '0;</pre>
<pre id="id182" style="background-color: #FFB6C1; margin:0; padding:0 ">      end else begin</pre>
<pre id="id183" style="background-color: #FFB6C1; margin:0; padding:0 ">        req_q   <= req_d;</pre>
<pre id="id184" style="background-color: #FFB6C1; margin:0; padding:0 ">        write_q <= write_d;</pre>
<pre id="id185" style="background-color: #FFB6C1; margin:0; padding:0 ">        addr_q  <= addr_d;</pre>
<pre id="id186" style="background-color: #FFB6C1; margin:0; padding:0 ">        wdata_q <= wdata_d;</pre>
<pre id="id187" style="background-color: #FFB6C1; margin:0; padding:0 ">        wmask_q <= wmask_d;</pre>
<pre id="id188" style="background-color: #FFB6C1; margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end else begin : gen_dirconnect_input</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign req_q   = req_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign write_q = write_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign addr_q  = addr_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign wdata_q = wdata_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign wmask_q = wmask_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  if (EnableOutputPipeline) begin : gen_regslice_output</pre>
<pre id="id199" style="background-color: #FFB6C1; margin:0; padding:0 ">    // Put the register slices between ECC decoding to output</pre>
<pre style="margin:0; padding:0 ">    always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre id="id201" style="background-color: #FFB6C1; margin:0; padding:0 ">      if (!rst_ni) begin</pre>
<pre id="id202" style="background-color: #FFB6C1; margin:0; padding:0 ">        rvalid_q <= '0;</pre>
<pre id="id203" style="background-color: #FFB6C1; margin:0; padding:0 ">        rdata_q  <= '0;</pre>
<pre id="id204" style="background-color: #FFB6C1; margin:0; padding:0 ">        rerror_q <= '0;</pre>
<pre id="id205" style="background-color: #FFB6C1; margin:0; padding:0 ">      end else begin</pre>
<pre id="id206" style="background-color: #FFB6C1; margin:0; padding:0 ">        rvalid_q <= rvalid_d;</pre>
<pre id="id207" style="background-color: #FFB6C1; margin:0; padding:0 ">        rdata_q  <= rdata_d;</pre>
<pre id="id208" style="background-color: #FFB6C1; margin:0; padding:0 ">        rerror_q <= rerror_d;</pre>
<pre id="id209" style="background-color: #FFB6C1; margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end else begin : gen_dirconnect_output</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign rvalid_q = rvalid_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign rdata_q  = rdata_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    assign rerror_q = rerror_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule : prim_ram_1p_adv</pre>
<pre id="id218" style="background-color: #FFB6C1; margin:0; padding:0 "></pre>
</body>
</html>
