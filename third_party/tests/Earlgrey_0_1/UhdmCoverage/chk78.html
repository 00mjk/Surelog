
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_pwrmgr_0.1/rtl/pwrmgr_fsm.sv Cov: 99% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// Power Manager Fast FSM</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">module pwrmgr_fsm import pwrmgr_pkg::*; (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input rst_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // interface with slow_fsm</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input req_pwrup_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input pwrup_cause_e pwrup_cause_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic ack_pwrup_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic req_pwrdn_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input ack_pwrdn_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input low_power_entry_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input main_pd_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input reset_req_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // consumed in pwrmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic wkup_o,        // generate wake interrupt</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic wkup_record_o, // enable wakeup recording</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic fall_through_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic abort_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic clr_hint_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic clr_cfg_lock_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // rstmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output pwr_rst_req_t pwr_rst_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input pwr_rst_rsp_t pwr_rst_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // clkmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic ips_clk_en_o,</pre>
<pre id="id38" style="background-color: #FFB6C1; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // otp</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic otp_init_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input otp_done_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input otp_idle_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // lc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic lc_init_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input lc_done_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input lc_idle_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // flash</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input flash_idle_i</pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // state enum</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  typedef enum logic [4:0] {</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StLowPower,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StEnableClocks,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StReleaseLcRst,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StOtpInit,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StLcInit,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StAckPwrUp,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StActive,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StDisClks,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StFallThrough,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StNvmIdleChk,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StLowPowerPrep,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StNvmShutDown,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StResetPrep,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    StReqPwrDn</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  } state_e;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // The code below always assumes the always on domain is index 0</pre>
<pre style="margin:0; padding:0 ">  `ASSERT_INIT(AlwaysOnIndex_A, ALWAYS_ON_DOMAIN == 0)</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // when there are multiple on domains, the latter 1 should become another parameter</pre>
<pre style="margin:0; padding:0 ">  localparam int OffDomainSelStart = ALWAYS_ON_DOMAIN + 1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // all powered down domains have resets asserted</pre>
<pre style="margin:0; padding:0 ">  logic pd_n_rsts_asserted;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // all domains have resets asserted</pre>
<pre style="margin:0; padding:0 ">  logic all_rsts_asserted;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // resets are valid</pre>
<pre style="margin:0; padding:0 ">  logic reset_valid;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // reset hint to rstmgr</pre>
<pre style="margin:0; padding:0 ">  reset_cause_e reset_cause_q, reset_cause_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  state_e state_d, state_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic reset_ongoing_q, reset_ongoing_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic req_pwrdn_q, req_pwrdn_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic ack_pwrup_q, ack_pwrup_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic ip_clk_en_q, ip_clk_en_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [PowerDomains-1:0] rst_lc_req_q, rst_sys_req_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [PowerDomains-1:0] rst_lc_req_d, rst_sys_req_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic otp_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic lc_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  assign pd_n_rsts_asserted = pwr_rst_i.rst_lc_src_n[PowerDomains-1:1] == '0 &</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                              pwr_rst_i.rst_sys_src_n[PowerDomains-1:1] == '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  assign all_rsts_asserted = pwr_rst_i.rst_lc_src_n == '0 &</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                             pwr_rst_i.rst_sys_src_n == '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // when in low power path, resets are controlled by domain power down</pre>
<pre style="margin:0; padding:0 ">  // when in reset path, all resets must be asserted</pre>
<pre style="margin:0; padding:0 ">  // when the reset cause is something else, it is invalid</pre>
<pre style="margin:0; padding:0 ">  assign reset_valid = reset_cause_q == LowPwrEntry ? main_pd_ni | pd_n_rsts_asserted :</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                       reset_cause_q == HwReq       ? all_rsts_asserted : 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_q <= StLowPower;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      ack_pwrup_q <= 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      req_pwrdn_q <= 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      reset_ongoing_q <= 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      ip_clk_en_q <= 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      rst_lc_req_q <= {PowerDomains{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      rst_sys_req_q <= {PowerDomains{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      reset_cause_q <= ResetUndefined;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_q <= state_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      ack_pwrup_q <= ack_pwrup_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      req_pwrdn_q <= req_pwrdn_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      reset_ongoing_q <= reset_ongoing_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      ip_clk_en_q <= ip_clk_en_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      rst_lc_req_q <= rst_lc_req_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      rst_sys_req_q <= rst_sys_req_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      reset_cause_q <= reset_cause_d;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  always_comb begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    otp_init = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    lc_init = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    wkup_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    wkup_record_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    fall_through_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    abort_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    clr_hint_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    clr_cfg_lock_o = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    state_d = state_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    ack_pwrup_d = ack_pwrup_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    req_pwrdn_d = req_pwrdn_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    reset_ongoing_d = reset_ongoing_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    ip_clk_en_d = ip_clk_en_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    rst_lc_req_d = rst_lc_req_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    rst_sys_req_d = rst_sys_req_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    reset_cause_d = reset_cause_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    unique case(state_q)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StLowPower: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        if (req_pwrup_i || reset_ongoing_q) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StEnableClocks;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StEnableClocks: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        ip_clk_en_d = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (1'b1) begin // TODO, add a feedback signal to check clocks are enabled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StReleaseLcRst;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StReleaseLcRst: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        rst_lc_req_d = '0;  // release rst_lc_n for all power domains</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (&pwr_rst_i.rst_lc_src_n) begin // once all resets are released</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StOtpInit;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StOtpInit: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        otp_init = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (otp_done_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StLcInit;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StLcInit: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        lc_init = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (lc_done_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StAckPwrUp;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StAckPwrUp: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        // only ack the slow_fsm if we actually transitioned through it</pre>
<pre style="margin:0; padding:0 ">        ack_pwrup_d = !reset_ongoing_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        // wait for request power up to drop relative to ack</pre>
<pre style="margin:0; padding:0 ">        if (!req_pwrup_i || reset_ongoing_q) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          ack_pwrup_d = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          clr_cfg_lock_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          wkup_o = pwrup_cause_i == Wake;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StActive;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StActive: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        rst_sys_req_d = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        reset_cause_d = ResetNone;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (reset_req_i || low_power_entry_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          reset_cause_d = ResetUndefined;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StDisClks;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StDisClks: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        ip_clk_en_d = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (1'b1) begin // TODO, add something to check that clocks are disabled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = reset_req_i ? StNvmShutDown : StFallThrough;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          wkup_record_o = !reset_req_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Low Power Path</pre>
<pre style="margin:0; padding:0 ">      StFallThrough: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        clr_hint_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        // the processor was interrupted after it asserted WFI and is executing again</pre>
<pre style="margin:0; padding:0 ">        if (!low_power_entry_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          ip_clk_en_d = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          wkup_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          fall_through_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StActive;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StNvmIdleChk;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StNvmIdleChk: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (otp_idle_i && lc_idle_i && flash_idle_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StLowPowerPrep;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          ip_clk_en_d = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          wkup_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          abort_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StActive;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StLowPowerPrep: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        reset_cause_d = LowPwrEntry;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        // reset non-always-on domains if requested</pre>
<pre style="margin:0; padding:0 ">        // this includes the clock manager, which implies pwr/rst managers must</pre>
<pre style="margin:0; padding:0 ">        // be fed directly from the source</pre>
<pre style="margin:0; padding:0 ">        for (int i = OffDomainSelStart; i < PowerDomains; i++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          rst_lc_req_d[i] = ~main_pd_ni;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          rst_sys_req_d[i] = ~main_pd_ni;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (reset_valid) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StReqPwrDn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StReqPwrDn: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        req_pwrdn_d = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (ack_pwrdn_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          req_pwrdn_d = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StLowPower;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Reset Path</pre>
<pre style="margin:0; padding:0 ">      // This state is TODO, the details are still under discussion</pre>
<pre style="margin:0; padding:0 ">      StNvmShutDown: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        clr_hint_o = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        reset_ongoing_d = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        state_d = StResetPrep;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      StResetPrep: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        reset_cause_d = HwReq;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        rst_lc_req_d = {PowerDomains{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        rst_sys_req_d = {PowerDomains{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">        if (reset_valid) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">          state_d = StLowPower;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        end</pre>
<pre style="margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">      // Terminal state, kill everything</pre>
<pre style="margin:0; padding:0 ">      default: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        rst_lc_req_d = {PowerDomains{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        rst_sys_req_d = {PowerDomains{1'b1}};</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">        ip_clk_en_d = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    endcase // unique case (state_q)</pre>
<pre style="margin:0; padding:0 ">  end // always_comb</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  assign ack_pwrup_o = ack_pwrup_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign req_pwrdn_o = req_pwrdn_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  assign pwr_rst_o.rst_lc_req = rst_lc_req_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign pwr_rst_o.rst_sys_req = rst_sys_req_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign pwr_rst_o.reset_cause = reset_cause_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  assign otp_init_o = otp_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign lc_init_o = lc_init;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign ips_clk_en_o = ip_clk_en_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
