
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_aes_0.6/rtl/aes_prng.sv Cov: 97% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// AES pseudo-random number generator</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// This module uses an LFSR connected to a PRINCE S-Box to provide pseudo-random data to the AES</pre>
<pre style="margin:0; padding:0 ">// module primarily for clearing registers. The LFSR can be reseeded using an external interface.</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">module aes_prng (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic        clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic        rst_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Connections to AES internals, PRNG consumers</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic        data_req_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic        data_ack_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic [63:0] data_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic        reseed_req_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic        reseed_ack_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Connections to outer world, LFSR re-seed</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic        entropy_req_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic        entropy_ack_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  logic [63:0] entropy_i</pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  localparam int unsigned DATA_WIDTH = 64;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic                  seed_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic                  lfsr_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [DATA_WIDTH-1:0] lfsr_state;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [DATA_WIDTH-1:0] scrambled;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // The data requests are fed from the LFSR, reseed requests have the highest priority.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign data_ack_o    = reseed_req_i ? 1'b0 : data_req_i;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Reseed requests are directly forwarded to the external interface.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign reseed_ack_o  = entropy_ack_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign entropy_req_o = reseed_req_i;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // LFSR control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign lfsr_en = data_req_i & data_ack_o;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign seed_en = entropy_req_o & entropy_ack_i;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // LFSR instance</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_lfsr #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .LfsrType    ( "GAL_XOR"  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .LfsrDw      ( DATA_WIDTH ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .StateOutDw  ( DATA_WIDTH )</pre>
<pre id="id50" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) aes_prng_lfsr (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i     ( clk_i      ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni    ( rst_ni     ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .seed_en_i ( seed_en    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .seed_i    ( entropy_i  ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .lfsr_en_i ( lfsr_en    ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .entropy_i (         '0 ),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .state_o   ( lfsr_state )</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // "Scramble" the LFSR state.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign scrambled = prim_cipher_pkg::sbox4_64bit(lfsr_state, prim_cipher_pkg::PRINCE_SBOX4);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign data_o    = prim_cipher_pkg::perm_64bit(scrambled, prim_cipher_pkg::PRESENT_PERM64);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
