
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_pwrmgr_0.1/rtl/pwrmgr.sv Cov: 100% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// Power Manager</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">module pwrmgr import pwrmgr_pkg::*;</pre>
<pre style="margin:0; padding:0 ">(</pre>
<pre style="margin:0; padding:0 ">  // Clocks and resets</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input clk_slow_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input rst_slow_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input rst_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Bus Interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  tlul_pkg::tl_h2d_t tl_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output tlul_pkg::tl_d2h_t tl_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // AST interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_ast_rsp_t pwr_ast_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output pwr_ast_req_t pwr_ast_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // rstmgr interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_rst_rsp_t pwr_rst_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output pwr_rst_req_t pwr_rst_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // clkmgr interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output pwr_clk_req_t pwr_clk_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_clk_rsp_t pwr_clk_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // otp interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_otp_rsp_t pwr_otp_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output pwr_otp_req_t pwr_otp_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // life cycle interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_lc_rsp_t pwr_lc_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output pwr_lc_req_t pwr_lc_o,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // flash interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_flash_t pwr_flash_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // processor interface</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_cpu_t pwr_cpu_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // peripherals interface, includes pinmux</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input  pwr_peri_t pwr_peri_i,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output intr_wakeup_o</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  import pwrmgr_reg_pkg::*;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  clk_i domain declarations</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_reg2hw_t reg2hw;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_hw2reg_t hw2reg;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwr_peri_t peri_reqs_masked;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic req_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic ack_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic req_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic ack_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrup_cause_e pwrup_cause;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic capture_en_pulse; // begin capture wakeup causes</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic low_power_fall_through;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic low_power_abort;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  clk_slow_i domain declarations</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Captured signals</pre>
<pre style="margin:0; padding:0 ">  // These signals, though on clk_i domain, are safe for clk_slow_i to use</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_reg2hw_wakeup_en_reg_t slow_wakeup_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_reg2hw_reset_en_reg_t slow_reset_en;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwr_ast_rsp_t slow_ast;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwr_peri_t slow_peri_reqs, slow_peri_reqs_masked;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrup_cause_e slow_pwrup_cause;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_pwrup_cause_toggle;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_req_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_ack_pwrup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_req_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_ack_pwrdn;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_main_pd_n;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_io_clk_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic slow_core_clk_en;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  Register module</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic low_power_hint;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic lowpwr_cfg_wen;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic clr_hint;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic wkup;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic clr_cfg_lock;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_reg_top i_reg (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .tl_o,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .devmode_i  (1'b1)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // whenever low power entry begins, wipe the hint</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.control.low_power_hint.d = 1'b0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.control.low_power_hint.de = clr_hint;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      lowpwr_cfg_wen <= 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else if (!lowpwr_cfg_wen && (clr_cfg_lock || wkup)) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      lowpwr_cfg_wen <= 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else if (low_power_hint) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      lowpwr_cfg_wen <= 1'b0;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.ctrl_cfg_regwen.d = lowpwr_cfg_wen;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  cdc handling</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_cdc i_cdc (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_slow_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_slow_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // slow domain signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_req_pwrup_i(slow_req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_ack_pwrdn_i(slow_ack_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_pwrup_cause_toggle_i(slow_pwrup_cause_toggle),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_pwrup_cause_i(slow_pwrup_cause),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_wakeup_en_o(slow_wakeup_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_reset_en_o(slow_reset_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_main_pd_no(slow_main_pd_n),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_io_clk_en_o(slow_io_clk_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_core_clk_en_o(slow_core_clk_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_req_pwrdn_o(slow_req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_ack_pwrup_o(slow_ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_ast_o(slow_ast),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_peri_reqs_o(slow_peri_reqs),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .slow_peri_reqs_masked_i(slow_peri_reqs_masked),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // fast domain signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .req_pwrdn_i(req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ack_pwrup_i(ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cfg_cdc_sync_i(reg2hw.cfg_cdc_sync.qe & reg2hw.cfg_cdc_sync.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .cdc_sync_done_o(hw2reg.cfg_cdc_sync.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wakeup_en_i(reg2hw.wakeup_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reset_en_i(reg2hw.reset_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .main_pd_ni(reg2hw.control.main_pd_n.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .io_clk_en_i(reg2hw.control.io_clk_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .core_clk_en_i(reg2hw.control.core_clk_en.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ack_pwrdn_o(ack_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .req_pwrup_o(req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .pwrup_cause_o(pwrup_cause),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .peri_reqs_o(peri_reqs_masked),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // AST signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ast_i(pwr_ast_i),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // peripheral signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .peri_i(pwr_peri_i)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign hw2reg.cfg_cdc_sync.d = 1'b0;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  Wakup and reset capture</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // reset and wakeup requests are captured into the slow clock domain and then</pre>
<pre style="margin:0; padding:0 ">  // fanned out to other domains as necessary.  This ensures there is not a huge</pre>
<pre style="margin:0; padding:0 ">  // time gap between when the slow clk domain sees the signal vs when the fast</pre>
<pre style="margin:0; padding:0 ">  // clock domains see it.  This creates redundant syncing but keeps the time</pre>
<pre style="margin:0; padding:0 ">  // scale approximately the same across all domains.</pre>
<pre style="margin:0; padding:0 ">  //</pre>
<pre style="margin:0; padding:0 ">  // This also implies that these signals must be at least 1 clk_slow pulse long</pre>
<pre style="margin:0; padding:0 ">  //</pre>
<pre style="margin:0; padding:0 ">  // Since resets are not latched inside pwrmgr, there exists a corner case where</pre>
<pre style="margin:0; padding:0 ">  // non-always-on reset requests may get wiped out by a graceful low power entry</pre>
<pre style="margin:0; padding:0 ">  // It's not clear if this is really an issue at the moment, but something to keep</pre>
<pre style="margin:0; padding:0 ">  // in mind if future changes are needed.</pre>
<pre style="margin:0; padding:0 ">  //</pre>
<pre style="margin:0; padding:0 ">  // Latching the reset requests is not difficult, but the bigger question is who</pre>
<pre style="margin:0; padding:0 ">  // should clear it and when that should happen. If the clearing does not work</pre>
<pre style="margin:0; padding:0 ">  // correctly, it is possible for the device to end up in a permanent reset loop,</pre>
<pre style="margin:0; padding:0 ">  // and that would be very undesirable.</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign slow_peri_reqs_masked.wakeups = slow_peri_reqs.wakeups & slow_wakeup_en;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign slow_peri_reqs_masked.rstreqs = slow_peri_reqs.rstreqs & slow_reset_en;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  clk_slow FSM</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_slow_fsm i_slow_fsm (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i                (clk_slow_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni               (rst_slow_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wakeup_i             (|slow_peri_reqs_masked.wakeups),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reset_req_i          (|slow_peri_reqs_masked.rstreqs),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ast_i                (slow_ast),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .req_pwrup_o          (slow_req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .pwrup_cause_o        (slow_pwrup_cause),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .pwrup_cause_toggle_o (slow_pwrup_cause_toggle),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ack_pwrup_i          (slow_ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .req_pwrdn_i          (slow_req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ack_pwrdn_o          (slow_ack_pwrdn),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .main_pd_ni           (slow_main_pd_n),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .io_clk_en_i          (slow_io_clk_en),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .core_clk_en_i        (slow_core_clk_en),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // outputs to AST - These are on the slow clock domain</pre>
<pre style="margin:0; padding:0 ">    // TBD - need to check this with partners</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ast_o                (pwr_ast_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  clk FSM</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign low_power_hint = reg2hw.control.low_power_hint.q == LowPower;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_fsm i_fsm (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni,</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // interface with slow_fsm</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .req_pwrup_i       (req_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .pwrup_cause_i     (pwrup_cause), // por, wake or reset request</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ack_pwrup_o       (ack_pwrup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .req_pwrdn_o       (req_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ack_pwrdn_i       (ack_pwrdn),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .low_power_entry_i (pwr_cpu_i.core_sleeping & low_power_hint),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reset_req_i       (|peri_reqs_masked.rstreqs),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // cfg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .main_pd_ni        (reg2hw.control.main_pd_n.q),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // consumed in pwrmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wkup_record_o     (capture_en_pulse),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wkup_o            (wkup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clr_cfg_lock_o    (clr_cfg_lock),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .fall_through_o    (low_power_fall_through),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .abort_o           (low_power_abort),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clr_hint_o        (clr_hint),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // rstmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .pwr_rst_o         (pwr_rst_o),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .pwr_rst_i         (pwr_rst_i),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // clkmgr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ips_clk_en_o      (pwr_clk_o.ip_clk_en),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // otp</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .otp_init_o        (pwr_otp_o.otp_init),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .otp_done_i        (pwr_otp_i.otp_done),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .otp_idle_i        (pwr_otp_i.otp_idle),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // lc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .lc_init_o         (pwr_lc_o.lc_init),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .lc_done_i         (pwr_lc_i.lc_done),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .lc_idle_i         (pwr_lc_i.lc_idle),</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">    // flash</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .flash_idle_i       (pwr_flash_i.flash_idle)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  Wakeup Info Capture</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic wake_info_wen;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [TotalWakeWidth-1:0] wake_info_data;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign wake_info_wen = reg2hw.wake_info.abort.qe |</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                         reg2hw.wake_info.fall_through.qe |</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                         reg2hw.wake_info.reasons.qe;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign wake_info_data = {reg2hw.wake_info.abort.q,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                           reg2hw.wake_info.fall_through.q,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                           reg2hw.wake_info.reasons.q};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  pwrmgr_wake_info i_wake_info (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wr_i            (wake_info_wen),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .data_i          (wake_info_data),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .start_capture_i (capture_en_pulse),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .record_dis_i    (reg2hw.wake_info_capture_dis.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .wakeups_i       (peri_reqs_masked.wakeups),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .fall_through_i  (low_power_fall_through),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .abort_i         (low_power_abort),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .info_o          (hw2reg.wake_info)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  Interrupts</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // This interrupt is asserted whenever the fast FSM transitions</pre>
<pre style="margin:0; padding:0 ">  // into active state.  However, it does not assert during POR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_intr_hw #(.Width(1)) intr_wakeup (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .event_intr_i           (wkup),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_enable_q_i (reg2hw.intr_enable.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_q_i   (reg2hw.intr_test.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_test_qe_i  (reg2hw.intr_test.qe),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .reg2hw_intr_state_q_i  (reg2hw.intr_state.q),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_de_o (hw2reg.intr_state.de),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .hw2reg_intr_state_d_o  (hw2reg.intr_state.d),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .intr_o                 (intr_wakeup_o)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 ">  ///  Assertions</pre>
<pre style="margin:0; padding:0 ">  ////////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule // pwrmgr</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
