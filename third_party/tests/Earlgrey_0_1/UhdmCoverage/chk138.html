
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_prim_all_0.1/rtl/prim_cipher_pkg.sv Cov: 92% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// This package holds common constants and functions for PRESENT- and</pre>
<pre style="margin:0; padding:0 ">// PRINCE-based scrambling devices.</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// See also: prim_present, prim_prince</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// References: - https://en.wikipedia.org/wiki/PRESENT</pre>
<pre style="margin:0; padding:0 ">//             - https://en.wikipedia.org/wiki/Prince_(cipher)</pre>
<pre style="margin:0; padding:0 ">//             - http://www.lightweightcrypto.org/present/present_ches2007.pdf</pre>
<pre style="margin:0; padding:0 ">//             - https://eprint.iacr.org/2012/529.pdf</pre>
<pre style="margin:0; padding:0 ">//             - https://eprint.iacr.org/2015/372.pdf</pre>
<pre style="margin:0; padding:0 ">//             - https://eprint.iacr.org/2014/656.pdf</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">package prim_cipher_pkg;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ///////////////////</pre>
<pre style="margin:0; padding:0 ">  // PRINCE Cipher //</pre>
<pre style="margin:0; padding:0 ">  ///////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0][3:0] PRINCE_SBOX4 = {4'h4, 4'hD, 4'h5, 4'hE,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                              4'h0, 4'h8, 4'h7, 4'h6,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                              4'h1, 4'h9, 4'hC, 4'hA,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                              4'h2, 4'h3, 4'hF, 4'hB};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0][3:0] PRINCE_SBOX4_INV = {4'h1, 4'hC, 4'hE, 4'h5,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                  4'h0, 4'h4, 4'h6, 4'hA,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                  4'h9, 4'h8, 4'hD, 4'hF,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                  4'h2, 4'h3, 4'h7, 4'hB};</pre>
<pre style="margin:0; padding:0 ">  // nibble permutations</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0][3:0] PRINCE_SHIFT_ROWS64  = '{4'hB, 4'h6, 4'h1, 4'hC,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                       4'h7, 4'h2, 4'hD, 4'h8,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                       4'h3, 4'hE, 4'h9, 4'h4,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                       4'hF, 4'hA, 4'h5, 4'h0};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0][3:0] PRINCE_SHIFT_ROWS64_INV = '{4'h3, 4'h6, 4'h9, 4'hC,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                          4'hF, 4'h2, 4'h5, 4'h8,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                          4'hB, 4'hE, 4'h1, 4'h4,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                          4'h7, 4'hA, 4'hD, 4'h0};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // these are the round constants</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [11:0][63:0] PRINCE_ROUND_CONST = {64'hC0AC29B7C97C50DD,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'hD3B5A399CA0C2399,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'h64A51195E0E3610D,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'hC882D32F25323C54,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'h85840851F1AC43AA,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'h7EF84F78FD955CB1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'hBE5466CF34E90C6C,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'h452821E638D01377,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'h082EFA98EC4E6C89,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'hA4093822299F31D0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'h13198A2E03707344,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                     64'h0000000000000000};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // tweak constant for key modification between enc/dec modes</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [63:0] PRINCE_ALPHA_CONST = 64'hC0AC29B7C97C50DD;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // masking constants for shift rows function below</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0] PRINCE_SHIFT_ROWS_CONST0 = 16'hEDB7;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0] PRINCE_SHIFT_ROWS_CONST1 = 16'h7EDB;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0] PRINCE_SHIFT_ROWS_CONST2 = 16'hB7ED;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0] PRINCE_SHIFT_ROWS_CONST3 = 16'hDB7E;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // nibble shifts</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [31:0] prince_shiftrows_32bit(logic [31:0]      state_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                         logic [15:0][3:0] shifts );</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [31:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // note that if simulation performance becomes an issue, this loop can be unrolled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < 32/2; k++) begin</pre>
<pre style="margin:0; padding:0 ">      // operate on pairs of 2bit instead of nibbles</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_out[k*2  +: 2] = state_in[shifts[k]*2  +: 2];</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id76" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : prince_shiftrows_32bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [63:0] prince_shiftrows_64bit(logic [63:0]      state_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                         logic [15:0][3:0] shifts );</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [63:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // note that if simulation performance becomes an issue, this loop can be unrolled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < 64/4; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_out[k*4  +: 4] = state_in[shifts[k]*4  +: 4];</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id86" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : prince_shiftrows_64bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // XOR reduction of four nibbles in a 16bit subvector</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [3:0] prince_nibble_red16(logic [15:0] vect);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return vect[0 +: 4] ^ vect[4 +: 4] ^ vect[8 +: 4] ^ vect[12 +: 4];</pre>
<pre id="id91" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : prince_nibble_red16</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // M prime multiplication</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [31:0] prince_mult_prime_32bit(logic [31:0] state_in);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [31:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // M0</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[0  +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST0);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[4  +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST1);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[8  +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST2);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[12 +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST3);</pre>
<pre style="margin:0; padding:0 ">    // M1</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[16 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST1);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[20 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST2);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[24 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST3);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[28 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST0);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id107" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : prince_mult_prime_32bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // M prime multiplication</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [63:0] prince_mult_prime_64bit(logic [63:0] state_in);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [63:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // M0</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[0  +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST0);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[4  +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST1);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[8  +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST2);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[12 +: 4] = prince_nibble_red16(state_in[ 0 +: 16] & PRINCE_SHIFT_ROWS_CONST3);</pre>
<pre style="margin:0; padding:0 ">    // M1</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[16 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST1);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[20 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST2);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[24 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST3);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[28 +: 4] = prince_nibble_red16(state_in[16 +: 16] & PRINCE_SHIFT_ROWS_CONST0);</pre>
<pre style="margin:0; padding:0 ">    // M1</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[32 +: 4] = prince_nibble_red16(state_in[32 +: 16] & PRINCE_SHIFT_ROWS_CONST1);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[36 +: 4] = prince_nibble_red16(state_in[32 +: 16] & PRINCE_SHIFT_ROWS_CONST2);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[40 +: 4] = prince_nibble_red16(state_in[32 +: 16] & PRINCE_SHIFT_ROWS_CONST3);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[44 +: 4] = prince_nibble_red16(state_in[32 +: 16] & PRINCE_SHIFT_ROWS_CONST0);</pre>
<pre style="margin:0; padding:0 ">    // M0</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[48 +: 4] = prince_nibble_red16(state_in[48 +: 16] & PRINCE_SHIFT_ROWS_CONST0);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[52 +: 4] = prince_nibble_red16(state_in[48 +: 16] & PRINCE_SHIFT_ROWS_CONST1);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[56 +: 4] = prince_nibble_red16(state_in[48 +: 16] & PRINCE_SHIFT_ROWS_CONST2);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    state_out[60 +: 4] = prince_nibble_red16(state_in[48 +: 16] & PRINCE_SHIFT_ROWS_CONST3);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id133" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : prince_mult_prime_64bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  ////////////////////</pre>
<pre style="margin:0; padding:0 ">  // PRESENT Cipher //</pre>
<pre style="margin:0; padding:0 ">  ////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // this is the sbox from the present cipher</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0][3:0] PRESENT_SBOX4 = {4'h2, 4'h1, 4'h7, 4'h4,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                               4'h8, 4'hF, 4'hE, 4'h3,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                               4'hD, 4'hA, 4'h0, 4'h9,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                               4'hB, 4'h6, 4'h5, 4'hC};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [15:0][3:0] PRESENT_SBOX4_INV = {4'hA, 4'h9, 4'h7, 4'h0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                   4'h3, 4'h6, 4'h4, 4'hB,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                   4'hD, 4'h2, 4'h1, 4'hC,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                   4'h8, 4'hF, 4'hE, 4'h5};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // these are modified permutation indices for a 32bit version that</pre>
<pre style="margin:0; padding:0 ">  // follow the same pattern as for the 64bit version</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [31:0][4:0] PRESENT_PERM32 = {5'd31, 5'd23, 5'd15, 5'd07,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                5'd30, 5'd22, 5'd14, 5'd06,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                5'd29, 5'd21, 5'd13, 5'd05,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                5'd28, 5'd20, 5'd12, 5'd04,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                5'd27, 5'd19, 5'd11, 5'd03,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                5'd26, 5'd18, 5'd10, 5'd02,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                5'd25, 5'd17, 5'd09, 5'd01,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                5'd24, 5'd16, 5'd08, 5'd00};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [31:0][4:0] PRESENT_PERM32_INV = {5'd31, 5'd27, 5'd23, 5'd19,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    5'd15, 5'd11, 5'd07, 5'd03,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    5'd30, 5'd26, 5'd22, 5'd18,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    5'd14, 5'd10, 5'd06, 5'd02,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    5'd29, 5'd25, 5'd21, 5'd17,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    5'd13, 5'd09, 5'd05, 5'd01,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    5'd28, 5'd24, 5'd20, 5'd16,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    5'd12, 5'd08, 5'd04, 5'd00};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // these are the permutation indices of the present cipher</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [63:0][5:0] PRESENT_PERM64 = {6'd63, 6'd47, 6'd31, 6'd15,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd62, 6'd46, 6'd30, 6'd14,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd61, 6'd45, 6'd29, 6'd13,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd60, 6'd44, 6'd28, 6'd12,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd59, 6'd43, 6'd27, 6'd11,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd58, 6'd42, 6'd26, 6'd10,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd57, 6'd41, 6'd25, 6'd09,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd56, 6'd40, 6'd24, 6'd08,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd55, 6'd39, 6'd23, 6'd07,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd54, 6'd38, 6'd22, 6'd06,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd53, 6'd37, 6'd21, 6'd05,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd52, 6'd36, 6'd20, 6'd04,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd51, 6'd35, 6'd19, 6'd03,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd50, 6'd34, 6'd18, 6'd02,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd49, 6'd33, 6'd17, 6'd01,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                6'd48, 6'd32, 6'd16, 6'd00};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter logic [63:0][5:0] PRESENT_PERM64_INV = {6'd63, 6'd59, 6'd55, 6'd51,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd47, 6'd43, 6'd39, 6'd35,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd31, 6'd27, 6'd23, 6'd19,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd15, 6'd11, 6'd07, 6'd03,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd62, 6'd58, 6'd54, 6'd50,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd46, 6'd42, 6'd38, 6'd34,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd30, 6'd26, 6'd22, 6'd18,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd14, 6'd10, 6'd06, 6'd02,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd61, 6'd57, 6'd53, 6'd49,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd45, 6'd41, 6'd37, 6'd33,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd29, 6'd25, 6'd21, 6'd17,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd13, 6'd09, 6'd05, 6'd01,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd60, 6'd56, 6'd52, 6'd48,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd44, 6'd40, 6'd36, 6'd32,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd28, 6'd24, 6'd20, 6'd16,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                    6'd12, 6'd08, 6'd04, 6'd00};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // forward key schedule</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [63:0] present_update_key64(logic [63:0] key_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                       logic [4:0]  round_idx);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [63:0] key_out;</pre>
<pre style="margin:0; padding:0 ">    // rotate by 61 to the left</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = 64'(key_in << 61) | 64'(key_in >> (64-61));</pre>
<pre style="margin:0; padding:0 ">    // sbox on uppermost 4 bits</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[63 -: 4] = PRESENT_SBOX4[key_out[63 -: 4]];</pre>
<pre style="margin:0; padding:0 ">    // xor in round counter on bits 19 to 15</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[19:15] ^= round_idx;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id217" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_update_key64</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [79:0] present_update_key80(logic [79:0] key_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                       logic [4:0]  round_idx);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [79:0] key_out;</pre>
<pre style="margin:0; padding:0 ">    // rotate by 61 to the left</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = 80'(key_in << 61) | 80'(key_in >> (80-61));</pre>
<pre style="margin:0; padding:0 ">    // sbox on uppermost 4 bits</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[79 -: 4] = PRESENT_SBOX4[key_out[79 -: 4]];</pre>
<pre style="margin:0; padding:0 ">    // xor in round counter on bits 19 to 15</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[19:15] ^= round_idx;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id229" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_update_key80</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [127:0] present_update_key128(logic [127:0] key_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                         logic [4:0]   round_idx);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [127:0] key_out;</pre>
<pre style="margin:0; padding:0 ">    // rotate by 61 to the left</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = 128'(key_in << 61) | 128'(key_in >> (128-61));</pre>
<pre style="margin:0; padding:0 ">    // sbox on uppermost 4 bits</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[127 -: 4] = PRESENT_SBOX4[key_out[127 -: 4]];</pre>
<pre style="margin:0; padding:0 ">    // xor in round counter on bits 19 to 15</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[19:15] ^= round_idx;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id241" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_update_key128</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // inverse key schedule</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [63:0] present_inv_update_key64(logic [63:0] key_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                           logic [4:0]  round_idx,</pre>
<pre style="margin:0; padding:0 ">                                                           // total number of rounds employed</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                           logic [4:0]  round_cnt);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [63:0] key_out;</pre>
<pre style="margin:0; padding:0 ">    // xor in round counter on bits 19 to 15</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[19:15] ^= 6'(round_cnt) + 1 - round_idx;</pre>
<pre style="margin:0; padding:0 ">    // sbox on uppermost 4 bits</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[63 -: 4] = PRESENT_SBOX4_INV[key_out[63 -: 4]];</pre>
<pre style="margin:0; padding:0 ">    // rotate by 61 to the right</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = 64'(key_in >> 61) | 64'(key_in << (64-61));</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id257" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_inv_update_key64</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [79:0] present_inv_update_key80(logic [79:0] key_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                           logic [4:0]  round_idx,</pre>
<pre style="margin:0; padding:0 ">                                                           // total number of rounds employed</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                           logic [4:0]  round_cnt);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [79:0] key_out;</pre>
<pre style="margin:0; padding:0 ">    // xor in round counter on bits 19 to 15</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[19:15] ^= 6'(round_cnt) + 1 - round_idx;</pre>
<pre style="margin:0; padding:0 ">    // sbox on uppermost 4 bits</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[79 -: 4] = PRESENT_SBOX4_INV[key_out[79 -: 4]];</pre>
<pre style="margin:0; padding:0 ">    // rotate by 61 to the right</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = 80'(key_in >> 61) | 80'(key_in << (80-61));</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id271" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_inv_update_key80</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [127:0] present_inv_update_key128(logic [127:0] key_in,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                             logic [4:0]   round_idx,</pre>
<pre style="margin:0; padding:0 ">                                                             // total number of rounds employed</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                             logic [4:0]   round_cnt);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [127:0] key_out;</pre>
<pre style="margin:0; padding:0 ">    // xor in round counter on bits 19 to 15</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[19:15] ^= 6'(round_cnt) + 1 - round_idx;</pre>
<pre style="margin:0; padding:0 ">    // sbox on uppermost 4 bits</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out[127 -: 4] = PRESENT_SBOX4_INV[key_out[127 -: 4]];</pre>
<pre style="margin:0; padding:0 ">    // rotate by 61 to the right</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = 128'(key_in >> 61) | 128'(key_in << (128-61));</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id285" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_inv_update_key128</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // these functions can be used to derive the DEC key from the ENC key by</pre>
<pre style="margin:0; padding:0 ">  // stepping the key by the correct number of rounds using the keyschedule functions above.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [63:0] present_get_dec_key64(logic [63:0] key_in,</pre>
<pre style="margin:0; padding:0 ">                                                        // total number of rounds employed</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                        logic [4:0]  round_cnt);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [63:0] key_out;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = key_in;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < round_cnt; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      key_out = present_update_key64(key_out, 5'(k + 1));</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id299" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_get_dec_key64</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [79:0] present_get_dec_key80(logic [79:0] key_in,</pre>
<pre style="margin:0; padding:0 ">                                                        // total number of rounds employed</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                        logic [4:0]  round_cnt);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [79:0] key_out;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = key_in;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < round_cnt; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      key_out = present_update_key80(key_out, 5'(k + 1));</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id310" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_get_dec_key80</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [127:0] present_get_dec_key128(logic [127:0] key_in,</pre>
<pre style="margin:0; padding:0 ">                                                          // total number of rounds employed</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">                                                          logic [4:0]   round_cnt);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [127:0] key_out;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    key_out = key_in;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < round_cnt; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      key_out = present_update_key128(key_out, 5'(k + 1));</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return key_out;</pre>
<pre id="id321" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : present_get_dec_key128</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  /////////////////////////</pre>
<pre style="margin:0; padding:0 ">  // Common Subfunctions //</pre>
<pre style="margin:0; padding:0 ">  /////////////////////////</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [31:0] sbox4_32bit(logic [31:0] state_in, logic [15:0][3:0] sbox4);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [31:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // note that if simulation performance becomes an issue, this loop can be unrolled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < 32/4; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_out[k*4  +: 4] = sbox4[state_in[k*4  +: 4]];</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id334" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : sbox4_32bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [63:0] sbox4_64bit(logic [63:0] state_in, logic [15:0][3:0] sbox4);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [63:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // note that if simulation performance becomes an issue, this loop can be unrolled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < 64/4; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_out[k*4  +: 4] = sbox4[state_in[k*4  +: 4]];</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id343" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : sbox4_64bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [31:0] perm_32bit(logic [31:0] state_in, logic [31:0][4:0] perm);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [31:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // note that if simulation performance becomes an issue, this loop can be unrolled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < 32; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_out[k] = state_in[perm[k]];</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id352" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : perm_32bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  function automatic logic [63:0] perm_64bit(logic [63:0] state_in, logic [63:0][5:0] perm);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [63:0] state_out;</pre>
<pre style="margin:0; padding:0 ">    // note that if simulation performance becomes an issue, this loop can be unrolled</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    for (int k = 0; k < 64; k++) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      state_out[k] = state_in[perm[k]];</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    return state_out;</pre>
<pre id="id361" style="background-color: #FFB6C1; margin:0; padding:0 ">  endfunction : perm_64bit</pre>
<pre style="margin:0; padding:0 "></pre>
<pre id="id363" style="background-color: #FFB6C1; margin:0; padding:0 ">endpackage : prim_cipher_pkg</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
