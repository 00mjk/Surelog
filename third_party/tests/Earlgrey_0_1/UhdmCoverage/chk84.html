
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_rstmgr_0.1/rtl/rstmgr_info.sv Cov: 97% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// This module records the reset reason</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">`include "prim_assert.sv"</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">module rstmgr_info #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int Reasons = 4</pre>
<pre style="margin:0; padding:0 ">) (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input clk_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input rst_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input rst_cpu_ni,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input [Reasons-1:0] rst_req_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input wr_i,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  input [Reasons:0] data_i,              // inclusive of POR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  output logic [Reasons:0] rst_reasons_o // inclusive of POR</pre>
<pre style="margin:0; padding:0 ">);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic [Reasons-1:0] reasons;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic por;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic first_reset;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  logic rst_cpu_nq;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  prim_flop_2sync #(</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .Width(1),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .ResetValue(0)</pre>
<pre id="id30" style="background-color: #FFB6C1; margin:0; padding:0 ">  ) u_cpu_reset_synced (</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .clk_i(clk_i),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .rst_ni(rst_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .d(rst_cpu_ni),</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    .q(rst_cpu_nq)</pre>
<pre style="margin:0; padding:0 ">  );</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // first reset is a flag that blocks reset recording until first de-assertion</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      first_reset <= 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else if (rst_cpu_nq) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      first_reset <= 1'b0;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // if cpu has gone into reset, record reset causes</pre>
<pre style="margin:0; padding:0 ">  // the reasons is a logical OR, so that signals that were once asserted do not go away.</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  always_ff @(posedge clk_i or negedge rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    if (!rst_ni) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      por <= 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      reasons <= '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else if (!rst_cpu_nq && !first_reset) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      reasons <= reasons | rst_req_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    end else if (wr_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">      {reasons, por} <= {reasons, por} & ~data_i;</pre>
<pre style="margin:0; padding:0 ">    end</pre>
<pre style="margin:0; padding:0 ">  end</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  assign rst_reasons_o = {reasons, por};</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endmodule // rstmgr_info</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
