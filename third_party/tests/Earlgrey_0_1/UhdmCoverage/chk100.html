
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>../src/lowrisc_ip_flash_ctrl_pkg_0.1/rtl/flash_phy_pkg.sv Cov: 95% </h3>
<pre style="margin:0; padding:0 ">// Copyright lowRISC contributors.</pre>
<pre style="margin:0; padding:0 ">// Licensed under the Apache License, Version 2.0, see LICENSE for details.</pre>
<pre style="margin:0; padding:0 ">// SPDX-License-Identifier: Apache-2.0</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 ">// Flash phy module package</pre>
<pre style="margin:0; padding:0 ">//</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">package flash_phy_pkg;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int NumBanks     = flash_ctrl_pkg::NumBanks;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int PagesPerBank = flash_ctrl_pkg::PagesPerBank;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int WordsPerPage = flash_ctrl_pkg::WordsPerPage;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int BytesPerWord = flash_ctrl_pkg::BytesPerWord;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int BankW        = flash_ctrl_pkg::BankW;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int PageW        = flash_ctrl_pkg::PageW;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int WordW        = flash_ctrl_pkg::WordW;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int BusWidth     = flash_ctrl_pkg::BusWidth;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int DataWidth    = flash_ctrl_pkg::DataWidth;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int NumBuf       = 4; // number of flash read buffers</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int RspOrderDepth = 2; // this should be DataWidth / BusWidth</pre>
<pre style="margin:0; padding:0 ">                                   // will switch to this after bus widening</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // This address width is from the perspective of the sw / flash controller</pre>
<pre style="margin:0; padding:0 ">  // which may assume a different width relative to the flash primitive</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int BankAddrW = flash_ctrl_pkg::BankAddrW;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // This address width is from the perspective of the flash primitive,</pre>
<pre style="margin:0; padding:0 ">  // which is an integer multiple of the bus width.  As a result, the number</pre>
<pre style="margin:0; padding:0 ">  // of relevant address bits changes.</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // address bits remain must be 0</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int AddrBitsRemain = DataWidth % BusWidth;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // must be powers of 2 multiple</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int WidthMultiple = DataWidth / BusWidth;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // number of flash words per page vs bus words per page</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int FlashWordsPerPage = WordsPerPage / WidthMultiple;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int FlashWordsW = $clog2(FlashWordsPerPage);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // base index</pre>
<pre style="margin:0; padding:0 ">  // This is the lsb position of the prim flash address when looking at the bus address</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int LsbAddrBit = $clog2(WidthMultiple);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int WordSelW = WidthMultiple == 1 ? 1 : LsbAddrBit;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // prim flash addr width</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int PrimFlashAddrW = BankAddrW - LsbAddrBit;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Read buffer metadata</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  typedef enum logic [1:0] {</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    Invalid     = 2'h0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    Wip         = 2'h1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    Valid       = 2'h2,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    Undef       = 2'h3</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  } rd_buf_attr_e;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  typedef struct packed {</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [DataWidth-1:0] data;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [PrimFlashAddrW-1:0] addr; // all address bits preserved to pick return portion</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    rd_buf_attr_e attr;</pre>
<pre id="id60" style="background-color: #FFB6C1; margin:0; padding:0 ">  } rd_buf_t;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  typedef struct packed {</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [NumBuf-1:0] buf_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    logic [WordSelW-1:0] word_sel;</pre>
<pre id="id65" style="background-color: #FFB6C1; margin:0; padding:0 ">  } rsp_fifo_entry_t;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  parameter int RspOrderFifoWidth = $bits(rsp_fifo_entry_t);</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Flash Operations Supported</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  typedef enum logic [2:0] {</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    PhyRead      = 3'h0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    PhyProg      = 3'h1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    PhyPgErase   = 3'h2,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    PhyBkErase   = 3'h3,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    PhyOps       = 3'h4</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  } flash_phy_op_e;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">  // Flash Operations Selected</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  typedef enum logic [1:0] {</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    None         = 2'h0,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    Host         = 2'h1,</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">    Ctrl         = 2'h2</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  } flash_phy_op_sel_e;</pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 "></pre>
<pre style="margin:0; padding:0 ">endpackage // flash_phy_pkg</pre>
<pre style="margin:0; padding:0 "></pre>
</body>
</html>
